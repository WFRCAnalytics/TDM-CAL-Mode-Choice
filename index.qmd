---
title: Calculating the Mode Choice Calibration Parameters
subtitle: Using Household Travel Survey and UTA On-Board Survey Data
description: Lorem Ipsum
author:
 - name: Pukar Bhandari
   email: pukar.bhandari@wfrc.utah.gov
   affiliation:
     - name: Wasatch Front Regional Council
       url: "https://wfrc.utah.gov/"
date: "2025-11-03"
---

# Setup Environment

This section prepares the Python environment with all necessary libraries and configurations. We'll import data manipulation libraries (pandas, numpy), and visualization tools (matplotlib, seaborn).

## Install Libraries

```python
!conda install -c conda-forge numpy pandas matplotlib seaborn requests pathlib BigQuery
```

## Import Libraries

```{python}
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

import importlib.util
from pathlib import Path
import sys
import os
import requests
import io

from dotenv import load_dotenv
load_dotenv()
```

## Environment Variables



## Helper Functions

```{python}
def fetch_github(
    url: str,
    mode: str = "private",
    token_env_var: str = "GITHUB_TOKEN"
) -> requests.Response:
    """
    Fetch content from GitHub repositories.

    Args:
        url: GitHub raw URL (e.g., https://raw.githubusercontent.com/...)
        mode: "public" for public repos, "private" for private repos requiring authentication
        token_env_var: Name of environment variable containing GitHub token (default: GITHUB_TOKEN)

    Returns:
        requests.Response object

    Raises:
        ValueError: If token is missing for private mode or invalid mode
        requests.HTTPError: If request fails
    """
    # Validate mode
    if mode not in ["public", "private"]:
        raise ValueError(f"mode must be 'public' or 'private', got '{mode}'")

    if mode == "public":
        response = requests.get(url, timeout=30)
    else:
        token = os.getenv(token_env_var)
        if not token:
            raise ValueError(
                f"GitHub token not found in environment variable '{token_env_var}'. "
                f"Check your .env file has: {token_env_var}=your_token_here"
            )

        headers = {
            'Authorization': f'token {token}',
            'Accept': 'application/vnd.github.v3.raw'
        }
        response = requests.get(url, headers=headers, timeout=30)

    response.raise_for_status()
    return response
```

## Setup BigQuery

```{python}
#| eval: false
#| echo: false

# # Import global TDM functions from local 'Resource' clone

# import sys
# sys.path.insert(0, '../Resources/2-Python/global-functions')
# import BigQuery

# client = BigQuery.getBigQueryClient_Confidential2023UtahHTS()
```

```{python}
# # Import global TDM functions from remote 'Resource' repo

# Fetch and import BigQuery module
response = fetch_github(
    'https://raw.githubusercontent.com/WFRCAnalytics/Resources/refs/heads/master/2-Python/global-functions/BigQuery.py',
    mode="public"
)

BigQuery = importlib.util.module_from_spec(importlib.util.spec_from_loader('BigQuery', loader=None))
exec(response.text, BigQuery.__dict__)

# Initiatlize BigQuery Client
client = BigQuery.getBigQueryClient_Confidential2023UtahHTS()
```

# Load Data

## UTA On-Board Survey

```{python}
# Read Processed UTA On-Board Survey Data directly from GitHub repo
response = fetch_github(
    "https://raw.githubusercontent.com/WFRCAnalytics/DATA-OBS-Prep-For-TDM/refs/heads/main/_output/UTA_OBS_2024_Processed.csv",
    mode = "private"
)

df_obs_processed = pd.read_csv(io.StringIO(response.text))
df_obs_processed
```

## Household Travel Survey

```{python}
# Load Household-level data from 2023 Household Travel Survey
df_hts_hh23 = client.query(
    "SELECT * FROM " + 'wfrc-modeling-data.prd_tdm_hts_2023.hh'
).to_dataframe()

df_hts_hh23
```

```{python}
# Load Person-level data from 2023 Household Travel Survey
df_hts_person23 = client.query(
    "SELECT * FROM " + 'wfrc-modeling-data.prd_tdm_hts_2023.person'
).to_dataframe()

df_hts_person23
```

# Identify Variable of Interest

## On-Board Survey

### Trip Purposes

```{python}
df_obs_processed["Purp5_text"].value_counts() # Trip Purpose: HBW, HBO, HBC, NHB, HBSch
```

### Peak vs Off-Peak

```{python}
df_obs_processed["PK_OK"].value_counts() # Peak vs Off-Peak
```

### Motorized vs Non-motorized

```{python}
df_obs_processed["Ac_Mode_Model"].value_counts() # Motorized (Drive) vs Non-motorized (Walk)
```

### Vehicle Ownership

```{python}
df_obs_processed["Veh_Cat3p"].value_counts() # Vehile Ownership Category: 0, 1, 2, 3+
```
