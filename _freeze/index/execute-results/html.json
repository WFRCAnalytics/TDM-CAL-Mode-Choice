{
  "hash": "fdc4b388de9a6304873c1a6ebc6c14b4",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Calculating the Mode Choice Calibration Parameters\nsubtitle: Using Household Travel Survey and UTA On-Board Survey Data\ndescription: Lorem Ipsum\nauthor:\n - name: Pukar Bhandari\n   email: pukar.bhandari@wfrc.utah.gov\n   affiliation:\n     - name: Wasatch Front Regional Council\n       url: \"https://wfrc.utah.gov/\"\ndate: \"2025-11-03\"\n---\n\n# Setup Environment\n\nThis section prepares the Python environment with all necessary libraries and configurations. We'll import data manipulation libraries (pandas, numpy), and visualization tools (matplotlib, seaborn).\n\n## Install Libraries\n\n```python\n!conda install -c conda-forge numpy pandas matplotlib seaborn requests pathlib BigQuery\n```\n\n## Import Libraries\n\n::: {#bac12d5d .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom pathlib import Path\n\nimport os\nimport requests\nimport io\nfrom dotenv import load_dotenv\nload_dotenv()\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```\nTrue\n```\n:::\n:::\n\n\n## Setup BigQuery\n\n::: {#3e4d9aa9 .cell execution_count=2}\n``` {.python .cell-code}\n# import global TDM functions\nimport sys\nsys.path.insert(0, '../Resources/2-Python/global-functions')\nimport BigQuery\n\nclient = BigQuery.getBigQueryClient_Confidential2023UtahHTS()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\npukar.bhandari\nC:/Users/Pukar.Bhandari/.private/confidential-2023-utah-hts-5fd7ddd219a7.json\n```\n:::\n:::\n\n\n## Environment Variables\n\n\n\n## Helper Functions\n\n::: {#2caa902b .cell execution_count=3}\n``` {.python .cell-code}\nimport os\nimport requests\n\ndef fetch_github(\n    url: str,\n    mode: str = \"private\",\n    token_env_var: str = \"GITHUB_TOKEN\"\n) -> requests.Response:\n    \"\"\"\n    Fetch content from GitHub repositories.\n\n    Args:\n        url: GitHub raw URL (e.g., https://raw.githubusercontent.com/...)\n        mode: \"public\" for public repos, \"private\" for private repos requiring authentication\n        token_env_var: Name of environment variable containing GitHub token (default: GITHUB_TOKEN)\n\n    Returns:\n        requests.Response object\n\n    Raises:\n        ValueError: If token is missing for private mode or invalid mode\n        requests.HTTPError: If request fails\n    \"\"\"\n    # Validate mode\n    if mode not in [\"public\", \"private\"]:\n        raise ValueError(f\"mode must be 'public' or 'private', got '{mode}'\")\n\n    if mode == \"public\":\n        response = requests.get(url, timeout=30)\n    else:\n        token = os.getenv(token_env_var)\n        if not token:\n            raise ValueError(\n                f\"GitHub token not found in environment variable '{token_env_var}'. \"\n                f\"Check your .env file has: {token_env_var}=your_token_here\"\n            )\n\n        headers = {\n            'Authorization': f'token {token}',\n            'Accept': 'application/vnd.github.v3.raw'\n        }\n        response = requests.get(url, headers=headers, timeout=30)\n\n    response.raise_for_status()\n    return response\n```\n:::\n\n\n# Load Data\n\n## UTA On-Board Survey\n\n::: {#9b47cfa6 .cell execution_count=4}\n``` {.python .cell-code}\nresponse = fetch_github(\n    \"https://raw.githubusercontent.com/WFRCAnalytics/DATA-OBS-Prep-For-TDM/refs/heads/main/_output/UTA_OBS_2024_Processed.csv\"\n)\ndf_obs_processed = pd.read_csv(io.StringIO(response.text))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nC:\\Users\\Pukar.Bhandari\\AppData\\Local\\Temp\\ipykernel_33112\\566214103.py:4: DtypeWarning: Columns (8,24,32,37,54,132,137,174) have mixed types. Specify dtype option on import or set low_memory=False.\n  df_obs_processed = pd.read_csv(io.StringIO(response.text))\n```\n:::\n:::\n\n\n## Household Travel Survey\n\n::: {#7ff20ee9 .cell execution_count=5}\n``` {.python .cell-code}\nhts_hh_23 = client.query(\"SELECT * FROM \" + 'wfrc-modeling-data.prd_tdm_hts_2023.hh').to_dataframe()\n\nhts_hh_23\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>hh_id</th>\n      <th>participation_group</th>\n      <th>is_complete</th>\n      <th>is_survey_complete</th>\n      <th>num_days_complete</th>\n      <th>num_days_survey_complete</th>\n      <th>num_days_complete_weekday</th>\n      <th>num_days_survey_complete_weekday</th>\n      <th>num_complete_mon</th>\n      <th>num_survey_complete_mon</th>\n      <th>...</th>\n      <th>num_vehicles_4cat</th>\n      <th>autosuf_wk</th>\n      <th>lifecycle</th>\n      <th>hh_children</th>\n      <th>hh_adults</th>\n      <th>hh_seniors</th>\n      <th>hh_weight_col_enrol</th>\n      <th>hh_weight</th>\n      <th>hCO_TAZID_USTMv3</th>\n      <th>hCO_TAZID_USTMv4</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>23472690</td>\n      <td>9</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>7</td>\n      <td>0</td>\n      <td>5</td>\n      <td>0</td>\n      <td>1</td>\n      <td>...</td>\n      <td>3</td>\n      <td>Sufficient</td>\n      <td>2</td>\n      <td>1</td>\n      <td>3</td>\n      <td>0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>3087</td>\n      <td>3087</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>23307416</td>\n      <td>9</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>7</td>\n      <td>0</td>\n      <td>5</td>\n      <td>0</td>\n      <td>1</td>\n      <td>...</td>\n      <td>3</td>\n      <td>Sufficient</td>\n      <td>2</td>\n      <td>4</td>\n      <td>3</td>\n      <td>0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>3111</td>\n      <td>3111</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>23317145</td>\n      <td>9</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>7</td>\n      <td>0</td>\n      <td>5</td>\n      <td>0</td>\n      <td>1</td>\n      <td>...</td>\n      <td>2</td>\n      <td>Sufficient</td>\n      <td>2</td>\n      <td>2</td>\n      <td>2</td>\n      <td>0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>3231</td>\n      <td>3231</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>23321176</td>\n      <td>9</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>5</td>\n      <td>0</td>\n      <td>5</td>\n      <td>0</td>\n      <td>1</td>\n      <td>...</td>\n      <td>2</td>\n      <td>Sufficient</td>\n      <td>3</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>3254</td>\n      <td>3254</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>23345703</td>\n      <td>9</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>...</td>\n      <td>2</td>\n      <td>Sufficient</td>\n      <td>1</td>\n      <td>0</td>\n      <td>2</td>\n      <td>0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>7001</td>\n      <td>7001</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>11178</th>\n      <td>23165031</td>\n      <td>9</td>\n      <td>1</td>\n      <td>1</td>\n      <td>7</td>\n      <td>7</td>\n      <td>5</td>\n      <td>5</td>\n      <td>1</td>\n      <td>1</td>\n      <td>...</td>\n      <td>1</td>\n      <td>Sufficient</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>NaN</td>\n      <td>152.530720</td>\n      <td>570407</td>\n      <td>570407</td>\n    </tr>\n    <tr>\n      <th>11179</th>\n      <td>23046966</td>\n      <td>9</td>\n      <td>1</td>\n      <td>1</td>\n      <td>7</td>\n      <td>7</td>\n      <td>5</td>\n      <td>5</td>\n      <td>1</td>\n      <td>1</td>\n      <td>...</td>\n      <td>1</td>\n      <td>Sufficient</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>NaN</td>\n      <td>98.388626</td>\n      <td>570415</td>\n      <td>570415</td>\n    </tr>\n    <tr>\n      <th>11180</th>\n      <td>23043011</td>\n      <td>9</td>\n      <td>1</td>\n      <td>1</td>\n      <td>7</td>\n      <td>7</td>\n      <td>5</td>\n      <td>5</td>\n      <td>1</td>\n      <td>1</td>\n      <td>...</td>\n      <td>1</td>\n      <td>Sufficient</td>\n      <td>1</td>\n      <td>0</td>\n      <td>2</td>\n      <td>0</td>\n      <td>NaN</td>\n      <td>28.238022</td>\n      <td>570417</td>\n      <td>570417</td>\n    </tr>\n    <tr>\n      <th>11181</th>\n      <td>23376736</td>\n      <td>9</td>\n      <td>1</td>\n      <td>1</td>\n      <td>7</td>\n      <td>7</td>\n      <td>5</td>\n      <td>5</td>\n      <td>1</td>\n      <td>1</td>\n      <td>...</td>\n      <td>1</td>\n      <td>Sufficient</td>\n      <td>3</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>NaN</td>\n      <td>135.715400</td>\n      <td>570419</td>\n      <td>570419</td>\n    </tr>\n    <tr>\n      <th>11182</th>\n      <td>23085912</td>\n      <td>9</td>\n      <td>1</td>\n      <td>1</td>\n      <td>7</td>\n      <td>7</td>\n      <td>5</td>\n      <td>5</td>\n      <td>1</td>\n      <td>1</td>\n      <td>...</td>\n      <td>3</td>\n      <td>Sufficient</td>\n      <td>3</td>\n      <td>0</td>\n      <td>0</td>\n      <td>2</td>\n      <td>NaN</td>\n      <td>51.868473</td>\n      <td>570419</td>\n      <td>570419</td>\n    </tr>\n  </tbody>\n</table>\n<p>11183 rows × 123 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {#ad9fe71d .cell execution_count=6}\n``` {.python .cell-code}\nhts_person_23 = client.query(\"SELECT * FROM \" + 'wfrc-modeling-data.prd_tdm_hts_2023.person').to_dataframe()\n\nhts_person_23\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>hh_id</th>\n      <th>is_complete</th>\n      <th>is_survey_complete</th>\n      <th>num_trips</th>\n      <th>person_id</th>\n      <th>person_num</th>\n      <th>surveyable</th>\n      <th>is_participant</th>\n      <th>relationship</th>\n      <th>age</th>\n      <th>...</th>\n      <th>lifegroup</th>\n      <th>age_3cat</th>\n      <th>adultJobs</th>\n      <th>seniorJobs</th>\n      <th>childJobs</th>\n      <th>person_made_trips</th>\n      <th>drive_work_trips</th>\n      <th>drive_work_distance</th>\n      <th>person_weight_col_enrol</th>\n      <th>person_weight</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>23483793</td>\n      <td>1</td>\n      <td>1</td>\n      <td>6</td>\n      <td>2348379307</td>\n      <td>7</td>\n      <td>1</td>\n      <td>1</td>\n      <td>3</td>\n      <td>6</td>\n      <td>...</td>\n      <td>adult</td>\n      <td>2.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>3</td>\n      <td>75.313295</td>\n      <td>NaN</td>\n      <td>299.938780</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>23233210</td>\n      <td>1</td>\n      <td>1</td>\n      <td>2</td>\n      <td>2323321004</td>\n      <td>4</td>\n      <td>1</td>\n      <td>1</td>\n      <td>4</td>\n      <td>4</td>\n      <td>...</td>\n      <td>None</td>\n      <td>NaN</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>12.921414</td>\n      <td>0.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>23252082</td>\n      <td>1</td>\n      <td>1</td>\n      <td>2</td>\n      <td>2325208202</td>\n      <td>2</td>\n      <td>1</td>\n      <td>1</td>\n      <td>3</td>\n      <td>8</td>\n      <td>...</td>\n      <td>adult</td>\n      <td>2.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>19.289847</td>\n      <td>NaN</td>\n      <td>599.010600</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>23085731</td>\n      <td>1</td>\n      <td>1</td>\n      <td>18</td>\n      <td>2308573101</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>6</td>\n      <td>...</td>\n      <td>adult</td>\n      <td>2.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0.000000</td>\n      <td>NaN</td>\n      <td>278.218930</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>23238026</td>\n      <td>1</td>\n      <td>1</td>\n      <td>5</td>\n      <td>2323802603</td>\n      <td>3</td>\n      <td>1</td>\n      <td>1</td>\n      <td>3</td>\n      <td>6</td>\n      <td>...</td>\n      <td>None</td>\n      <td>NaN</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>6.861802</td>\n      <td>0.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>13884</th>\n      <td>23356285</td>\n      <td>1</td>\n      <td>1</td>\n      <td>12</td>\n      <td>2335628501</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>8</td>\n      <td>...</td>\n      <td>adult</td>\n      <td>2.0</td>\n      <td>2</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0.000000</td>\n      <td>NaN</td>\n      <td>111.541504</td>\n    </tr>\n    <tr>\n      <th>13885</th>\n      <td>23346608</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>2334660803</td>\n      <td>3</td>\n      <td>1</td>\n      <td>1</td>\n      <td>2</td>\n      <td>4</td>\n      <td>...</td>\n      <td>adult</td>\n      <td>2.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.000000</td>\n      <td>NaN</td>\n      <td>83.666885</td>\n    </tr>\n    <tr>\n      <th>13886</th>\n      <td>23186778</td>\n      <td>1</td>\n      <td>1</td>\n      <td>2</td>\n      <td>2318677801</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>5</td>\n      <td>...</td>\n      <td>adult</td>\n      <td>2.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0.000000</td>\n      <td>NaN</td>\n      <td>228.358470</td>\n    </tr>\n    <tr>\n      <th>13887</th>\n      <td>23371593</td>\n      <td>1</td>\n      <td>1</td>\n      <td>36</td>\n      <td>2337159303</td>\n      <td>3</td>\n      <td>1</td>\n      <td>1</td>\n      <td>3</td>\n      <td>8</td>\n      <td>...</td>\n      <td>adult</td>\n      <td>2.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0.000000</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>13888</th>\n      <td>23350564</td>\n      <td>1</td>\n      <td>1</td>\n      <td>52</td>\n      <td>2335056401</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>6</td>\n      <td>...</td>\n      <td>adult</td>\n      <td>2.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0.000000</td>\n      <td>NaN</td>\n      <td>184.878130</td>\n    </tr>\n  </tbody>\n</table>\n<p>29873 rows × 126 columns</p>\n</div>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}