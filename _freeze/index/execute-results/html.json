{
  "hash": "14596efcfa8ebda4d98d62c64c62103c",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Calculating the Mode Choice Calibration Parameters\nsubtitle: Using Household Travel Survey and UTA On-Board Survey Data\ndescription: Lorem Ipsum\nauthor:\n - name: Pukar Bhandari\n   email: pukar.bhandari@wfrc.utah.gov\n   affiliation:\n     - name: Wasatch Front Regional Council\n       url: \"https://wfrc.utah.gov/\"\ndate: \"2025-11-03\"\n---\n\n# Setup Environment\n\nThis section prepares the Python environment with all necessary libraries and configurations. We'll import data manipulation libraries (pandas, numpy), and visualization tools (matplotlib, seaborn).\n\n## Install Libraries\n\n```python\n!conda install -c conda-forge numpy pandas matplotlib seaborn requests pathlib BigQuery\n```\n\n## Import Libraries\n\n::: {#879bf39b .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport importlib.util\nfrom pathlib import Path\nimport sys\nimport os\nimport requests\nimport io\n\nfrom dotenv import load_dotenv\nload_dotenv()\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```\nTrue\n```\n:::\n:::\n\n\n## Environment Variables\n\n\n\n## Helper Functions\n\n::: {#e13cd601 .cell execution_count=2}\n``` {.python .cell-code}\ndef fetch_github(\n    url: str,\n    mode: str = \"private\",\n    token_env_var: str = \"GITHUB_TOKEN\"\n) -> requests.Response:\n    \"\"\"\n    Fetch content from GitHub repositories.\n\n    Args:\n        url: GitHub raw URL (e.g., https://raw.githubusercontent.com/...)\n        mode: \"public\" for public repos, \"private\" for private repos requiring authentication\n        token_env_var: Name of environment variable containing GitHub token (default: GITHUB_TOKEN)\n\n    Returns:\n        requests.Response object\n\n    Raises:\n        ValueError: If token is missing for private mode or invalid mode\n        requests.HTTPError: If request fails\n    \"\"\"\n    # Validate mode\n    if mode not in [\"public\", \"private\"]:\n        raise ValueError(f\"mode must be 'public' or 'private', got '{mode}'\")\n\n    if mode == \"public\":\n        response = requests.get(url, timeout=30)\n    else:\n        token = os.getenv(token_env_var)\n        if not token:\n            raise ValueError(\n                f\"GitHub token not found in environment variable '{token_env_var}'. \"\n                f\"Check your .env file has: {token_env_var}=your_token_here\"\n            )\n\n        headers = {\n            'Authorization': f'token {token}',\n            'Accept': 'application/vnd.github.v3.raw'\n        }\n        response = requests.get(url, headers=headers, timeout=30)\n\n    response.raise_for_status()\n    return response\n```\n:::\n\n\n::: {#d280e644 .cell execution_count=3}\n``` {.python .cell-code}\ndef calculate_categorical_shares(\n    df,\n    category_col,\n    weight_col='LINKED_WEIGHT',\n    group_cols=['Veh_Cat3p', 'Purp5_text', 'PK_OK'],\n    filter_condition=None,\n    category_mapping=None,\n    prefix='share',\n    purpose_by_period=['HBW', 'HBO', 'NHB'],  # Only HBC and HBSch get daily\n    purpose_daily=['HBC', 'HBSch']  # NEW: Purposes that only get daily (no peak/off-peak)\n):\n    \"\"\"\n    Calculate weighted shares of categories within groups, ensuring they sum to 1.\n\n    Parameters:\n    -----------\n    df : DataFrame\n        Input dataframe\n    category_col : str\n        Column containing the categories to calculate shares for\n    weight_col : str\n        Column containing weights for each observation\n    group_cols : list\n        Columns to group by (e.g., vehicle ownership, purpose, peak/off-peak)\n    filter_condition : str or None\n        Optional pandas query string to filter data before calculation\n    category_mapping : dict or None\n        Optional mapping to rename/recode categories\n    prefix : str\n        Prefix for output column names\n    purpose_by_period : list\n        Purposes that should NOT get daily aggregates\n    purpose_daily : list\n        Purposes that ONLY get daily aggregates (no peak/off-peak breakdown)\n\n    Returns:\n    --------\n    DataFrame with shares in wide format\n    \"\"\"\n\n    # Apply filter and copy in one step\n    if filter_condition:\n        df_work = df.query(filter_condition).copy()\n    else:\n        df_work = df.copy()\n\n    # Apply category mapping if provided\n    if category_mapping:\n        df_work[category_col] = df_work[category_col].map(category_mapping)\n        # Remove unmapped values\n        df_work = df_work.dropna(subset=[category_col])\n\n    # Remove any NaN values in key columns\n    df_work = df_work.dropna(subset=[category_col, weight_col] + group_cols)\n\n    # Convert Veh_Cat3p to string format for consistency\n    df_work['Veh_Cat3p'] = df_work['Veh_Cat3p'].astype(str)\n    # Map 3 to 3+ for display\n    # df_work['Veh_Cat3p'] = df_work['Veh_Cat3p'].replace('3', '3+')\n\n    # Initialize results dictionary\n    results = {}\n\n    # Calculate weighted shares for each group combination (peak/off-peak)\n    # BUT skip purpose_daily\n    for veh in sorted(df_work['Veh_Cat3p'].unique()):\n        for purpose in sorted(df_work['Purp5_text'].unique()):\n            # Skip peak/off-peak for daily-only purposes\n            if purpose in purpose_daily:\n                continue\n\n            for peak in sorted(df_work['PK_OK'].unique()):\n                subset = df_work.query(\n                    f\"Veh_Cat3p == '{veh}' & Purp5_text == '{purpose}' & PK_OK == '{peak}'\"\n                )\n\n                if len(subset) > 0:\n                    # Calculate weighted counts by category\n                    weighted_counts = subset.groupby(category_col)[weight_col].sum()\n                    total_weight = subset[weight_col].sum()\n\n                    for cat, weighted_count in weighted_counts.items():\n                        var_name = f\"{prefix}_{cat}_{veh}veh\"\n                        if var_name not in results:\n                            results[var_name] = {}\n                        results[var_name][(purpose, peak)] = weighted_count / total_weight\n\n    # Calculate \"_all\" aggregates for peak/off-peak (excluding daily-only purposes)\n    for purpose in sorted(df_work['Purp5_text'].unique()):\n        # Skip peak/off-peak for daily-only purposes\n        if purpose in purpose_daily:\n            continue\n\n        for peak in sorted(df_work['PK_OK'].unique()):\n            subset = df_work.query(f\"Purp5_text == '{purpose}' & PK_OK == '{peak}'\")\n\n            if len(subset) > 0:\n                weighted_counts = subset.groupby(category_col)[weight_col].sum()\n                total_weight = subset[weight_col].sum()\n\n                for cat, weighted_count in weighted_counts.items():\n                    var_name = f\"{prefix}_{cat}_all\"\n                    if var_name not in results:\n                        results[var_name] = {}\n                    results[var_name][(purpose, peak)] = weighted_count / total_weight\n\n    # Calculate daily aggregates for specified purposes only\n    daily_purposes = [p for p in df_work['Purp5_text'].unique()\n                     if p not in purpose_by_period]\n\n    for purpose in daily_purposes:\n        subset = df_work.query(f\"Purp5_text == '{purpose}'\")\n\n        if len(subset) > 0:\n            # For each vehicle category\n            for veh in sorted(df_work['Veh_Cat3p'].unique()):\n                veh_subset = subset.query(f\"Veh_Cat3p == '{veh}'\")\n                if len(veh_subset) > 0:\n                    weighted_counts = veh_subset.groupby(category_col)[weight_col].sum()\n                    total_weight = veh_subset[weight_col].sum()\n\n                    for cat, weighted_count in weighted_counts.items():\n                        var_name = f\"{prefix}_{cat}_{veh}veh\"\n                        if var_name not in results:\n                            results[var_name] = {}\n                        results[var_name][(purpose, 'Daily')] = weighted_count / total_weight\n\n            # For \"all\" vehicle categories\n            weighted_counts = subset.groupby(category_col)[weight_col].sum()\n            total_weight = subset[weight_col].sum()\n\n            for cat, weighted_count in weighted_counts.items():\n                var_name = f\"{prefix}_{cat}_all\"\n                if var_name not in results:\n                    results[var_name] = {}\n                results[var_name][(purpose, 'Daily')] = weighted_count / total_weight\n\n    # Convert to DataFrame\n    df_result = pd.DataFrame(results).T\n    df_result.columns = pd.MultiIndex.from_tuples(df_result.columns)\n    df_result = df_result.fillna(0)\n\n    # Sort index\n    df_result = df_result.sort_index()\n\n    return df_result\n```\n:::\n\n\n::: {#63fe6190 .cell execution_count=4}\n``` {.python .cell-code}\n# Verify categorical shares sum to 1.0000\ndef verify_shares(df_shares, tolerance=0.01):\n    \"\"\"\n    Verify that shares sum to approximately 1 within each vehicle category group.\n\n    Now that we have separate rows for each vehicle ownership category (0veh, 1veh, 2veh, 3+veh, all),\n    we need to verify that shares sum to 1 within each vehicle category separately.\n    \"\"\"\n    print(\"=== Verifying Share Sums ===\\n\")\n\n    # Extract vehicle categories from index\n    # Assuming format: calib_share_{category}_{veh_category}\n    vehicle_categories = df_shares.index.str.extract(r'_(\\d\\+?veh|all)$')[0].unique()\n\n    print(f\"Vehicle categories found: {sorted(vehicle_categories)}\\n\")\n\n    all_good = True\n    issues = []\n\n    # Check each vehicle category separately\n    for veh_cat in sorted(vehicle_categories):\n        # Filter rows for this vehicle category\n        mask = df_shares.index.str.endswith(f'_{veh_cat}')\n        df_veh = df_shares[mask]\n\n        print(f\"--- Checking {veh_cat} ({len(df_veh)} categories) ---\")\n\n        # Check sums for each column within this vehicle category\n        veh_issues = []\n        for col in df_veh.columns:\n            col_sum = df_veh[col].sum()\n\n            if abs(col_sum - 1.0) > tolerance:\n                all_good = False\n                veh_issues.append((col, col_sum))\n\n        if not veh_issues:\n            print(f\"  ‚úÖ All shares sum to 1.0 for {veh_cat}\")\n        else:\n            print(f\"  ‚ö†Ô∏è  {len(veh_issues)} columns don't sum to 1.0 for {veh_cat}:\")\n            for col, sum_val in veh_issues[:5]:  # Show first 5\n                print(f\"     {col}: {sum_val:.4f}\")\n            if len(veh_issues) > 5:\n                print(f\"     ... and {len(veh_issues) - 5} more\")\n            issues.extend([(veh_cat, col, sum_val) for col, sum_val in veh_issues])\n        print()\n\n    print(f\"{'='*60}\")\n    if all_good:\n        print(\"‚úÖ ALL VEHICLE CATEGORIES: Shares sum to 1.0 (within tolerance)\")\n    else:\n        print(f\"‚ö†Ô∏è  WARNING: {len(issues)} total column/vehicle combinations don't sum to 1.0\")\n\n    print(f\"\\nTotal columns: {len(df_shares.columns)}\")\n    print(f\"Total vehicle categories: {len(vehicle_categories)}\")\n    print(f\"Total combinations: {len(df_shares.columns) * len(vehicle_categories)}\")\n\n    # Return sums by vehicle category\n    return {veh_cat: df_shares[df_shares.index.str.endswith(f'_{veh_cat}')].sum(axis=0)\n            for veh_cat in sorted(vehicle_categories)}\n```\n:::\n\n\n## Setup BigQuery\n\n\n\n::: {#d5b122fa .cell execution_count=6}\n``` {.python .cell-code}\n# # Import global TDM functions from remote 'Resource' repo\n\n# Fetch and import BigQuery module\nresponse = fetch_github(\n    'https://raw.githubusercontent.com/WFRCAnalytics/Resources/refs/heads/master/2-Python/global-functions/BigQuery.py',\n    mode=\"public\"\n)\n\nBigQuery = importlib.util.module_from_spec(importlib.util.spec_from_loader('BigQuery', loader=None))\nexec(response.text, BigQuery.__dict__)\n\n# Initiatlize BigQuery Client\nclient = BigQuery.getBigQueryClient_Confidential2023UtahHTS()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\npukar.bhandari\nC:/Users/Pukar.Bhandari/.private/confidential-2023-utah-hts-5fd7ddd219a7.json\n```\n:::\n:::\n\n\n# Load Data\n\n## UTA On-Board Survey\n\n::: {#38fdc2fb .cell execution_count=7}\n``` {.python .cell-code}\n# Read Linked UTA On-Board Survey Data directly from GitHub repo\nresponse = fetch_github(\n    \"https://raw.githubusercontent.com/WFRCAnalytics/DATA-OBS-Prep-For-TDM/refs/heads/main/_output/UTA_OBS_2024_Linked.csv\",\n    mode = \"private\"\n)\n\ndf_obs_linked = pd.read_csv(io.StringIO(response.text))\ndf_obs_linked\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nC:\\Users\\Pukar.Bhandari\\AppData\\Local\\Temp\\ipykernel_24128\\4156658631.py:7: DtypeWarning:\n\nColumns (8,24,32,37,54,132,137,174) have mixed types. Specify dtype option on import or set low_memory=False.\n\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>ID</th>\n      <th>DATE_COMPLETED</th>\n      <th>DATE_TYPE</th>\n      <th>ROUTE_DIRECTION_Code</th>\n      <th>ROUTE_DIRECTION</th>\n      <th>ROUTE_DIRECTION_Other</th>\n      <th>HOME_ADDRESS_CITY</th>\n      <th>HOME_ADDRESS_STATE</th>\n      <th>HOME_ADDRESS_ZIP</th>\n      <th>HOME_ADDRESS_LAT</th>\n      <th>...</th>\n      <th>p_Stop_lat</th>\n      <th>p_Stop_lon</th>\n      <th>a_Stop_lat</th>\n      <th>a_Stop_lon</th>\n      <th>p_Stop_N</th>\n      <th>a_Stop_N</th>\n      <th>access_dist</th>\n      <th>access_time</th>\n      <th>egress_dist</th>\n      <th>egress_time</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>5948</td>\n      <td>2/27/2024</td>\n      <td>Weekday</td>\n      <td>UTA_1_2_00</td>\n      <td>2 200 SOUTH - TO U HOSPITAL</td>\n      <td>NaN</td>\n      <td>Clearfield</td>\n      <td>UT</td>\n      <td>84015</td>\n      <td>41.119565</td>\n      <td>...</td>\n      <td>41.118979</td>\n      <td>-112.025922</td>\n      <td>40.769221</td>\n      <td>-111.898663</td>\n      <td>27702.0</td>\n      <td>25493.0</td>\n      <td>0.37</td>\n      <td>8.79</td>\n      <td>0.68</td>\n      <td>16.27</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>6067</td>\n      <td>2/27/2024</td>\n      <td>Weekday</td>\n      <td>UTA_1_47_00</td>\n      <td>47 4700 SOUTH - TO W VALLEY CTL</td>\n      <td>NaN</td>\n      <td>West Valley City</td>\n      <td>UT</td>\n      <td>84119</td>\n      <td>40.689590</td>\n      <td>...</td>\n      <td>40.689384</td>\n      <td>-111.967476</td>\n      <td>40.660941</td>\n      <td>-111.899443</td>\n      <td>23195.0</td>\n      <td>23685.0</td>\n      <td>0.56</td>\n      <td>13.53</td>\n      <td>0.24</td>\n      <td>5.70</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>6069</td>\n      <td>3/16/2024</td>\n      <td>Saturday</td>\n      <td>UTA_1_750_01</td>\n      <td>FRONTRUNNER 750 - SOUTHBOUND</td>\n      <td>NaN</td>\n      <td>Ogden</td>\n      <td>UT</td>\n      <td>84401</td>\n      <td>41.186697</td>\n      <td>...</td>\n      <td>41.188757</td>\n      <td>-112.039378</td>\n      <td>40.784356</td>\n      <td>-111.982117</td>\n      <td>10042.0</td>\n      <td>15093.0</td>\n      <td>1.15</td>\n      <td>2.76</td>\n      <td>0.20</td>\n      <td>4.89</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>6073</td>\n      <td>2/28/2024</td>\n      <td>Weekday</td>\n      <td>UTA_1_750_01</td>\n      <td>FRONTRUNNER 750 - SOUTHBOUND</td>\n      <td>NaN</td>\n      <td>Ogden</td>\n      <td>UT</td>\n      <td>84401</td>\n      <td>41.236749</td>\n      <td>...</td>\n      <td>41.188757</td>\n      <td>-112.039378</td>\n      <td>40.659758</td>\n      <td>-111.896432</td>\n      <td>10042.0</td>\n      <td>10016.0</td>\n      <td>4.17</td>\n      <td>8.22</td>\n      <td>1.37</td>\n      <td>3.29</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>6077</td>\n      <td>2/28/2024</td>\n      <td>Weekday</td>\n      <td>UTA_1_47_00</td>\n      <td>47 4700 SOUTH - TO W VALLEY CTL</td>\n      <td>NaN</td>\n      <td>West Valley City</td>\n      <td>UT</td>\n      <td>84119</td>\n      <td>40.669687</td>\n      <td>...</td>\n      <td>40.667711</td>\n      <td>-111.961123</td>\n      <td>40.681907</td>\n      <td>-112.024041</td>\n      <td>22922.0</td>\n      <td>22421.0</td>\n      <td>0.25</td>\n      <td>6.00</td>\n      <td>0.49</td>\n      <td>11.88</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>13790</th>\n      <td>30339</td>\n      <td>4/26/2024</td>\n      <td>Weekday</td>\n      <td>UTA_1_704_01</td>\n      <td>TRAX GREEN LINE 704 - TO AIRPORT</td>\n      <td>NaN</td>\n      <td>Salt Lake City</td>\n      <td>UT</td>\n      <td>84116</td>\n      <td>40.772420</td>\n      <td>...</td>\n      <td>40.771536</td>\n      <td>-111.945736</td>\n      <td>40.771502</td>\n      <td>-111.914486</td>\n      <td>15101.0</td>\n      <td>15122.0</td>\n      <td>0.31</td>\n      <td>7.53</td>\n      <td>0.17</td>\n      <td>4.07</td>\n    </tr>\n    <tr>\n      <th>13791</th>\n      <td>30340</td>\n      <td>4/26/2024</td>\n      <td>Weekday</td>\n      <td>UTA_1_704_00</td>\n      <td>TRAX GREEN LINE 704 - TO WEST VALLEY</td>\n      <td>NaN</td>\n      <td>Salt Lake City</td>\n      <td>UT</td>\n      <td>84116</td>\n      <td>40.771361</td>\n      <td>...</td>\n      <td>40.771505</td>\n      <td>-111.915361</td>\n      <td>40.750058</td>\n      <td>-111.896818</td>\n      <td>15122.0</td>\n      <td>15109.0</td>\n      <td>0.46</td>\n      <td>11.00</td>\n      <td>1.21</td>\n      <td>29.10</td>\n    </tr>\n    <tr>\n      <th>13792</th>\n      <td>30341</td>\n      <td>4/26/2024</td>\n      <td>Weekday</td>\n      <td>UTA_1_704_00</td>\n      <td>TRAX GREEN LINE 704 - TO WEST VALLEY</td>\n      <td>NaN</td>\n      <td>Salt Lake City</td>\n      <td>UT</td>\n      <td>84116</td>\n      <td>40.773232</td>\n      <td>...</td>\n      <td>40.771505</td>\n      <td>-111.915361</td>\n      <td>40.725345</td>\n      <td>-111.877499</td>\n      <td>15122.0</td>\n      <td>24968.0</td>\n      <td>0.17</td>\n      <td>4.07</td>\n      <td>0.86</td>\n      <td>20.68</td>\n    </tr>\n    <tr>\n      <th>13793</th>\n      <td>1000002</td>\n      <td>2/29/2024</td>\n      <td>Weekday</td>\n      <td>UTA_1_701_00</td>\n      <td>TRAX BLUE LINE 701 - TO DRAPER</td>\n      <td>NaN</td>\n      <td>Salt Lake City</td>\n      <td>UT</td>\n      <td>84111</td>\n      <td>40.751607</td>\n      <td>...</td>\n      <td>40.755113</td>\n      <td>-111.891095</td>\n      <td>40.674859</td>\n      <td>-111.943134</td>\n      <td>15123.0</td>\n      <td>23342.0</td>\n      <td>0.33</td>\n      <td>7.95</td>\n      <td>0.29</td>\n      <td>7.02</td>\n    </tr>\n    <tr>\n      <th>13794</th>\n      <td>1000004</td>\n      <td>2/29/2024</td>\n      <td>Weekday</td>\n      <td>UTA_1_701_00</td>\n      <td>TRAX BLUE LINE 701 - TO DRAPER</td>\n      <td>NaN</td>\n      <td>Salt Lake City</td>\n      <td>UT</td>\n      <td>84109</td>\n      <td>40.722068</td>\n      <td>...</td>\n      <td>40.725878</td>\n      <td>-111.830935</td>\n      <td>40.525496</td>\n      <td>-111.858805</td>\n      <td>25663.0</td>\n      <td>15041.0</td>\n      <td>0.79</td>\n      <td>18.85</td>\n      <td>0.19</td>\n      <td>4.44</td>\n    </tr>\n  </tbody>\n</table>\n<p>13795 rows √ó 303 columns</p>\n</div>\n```\n:::\n:::\n\n\n## Household Travel Survey\n\n::: {#3635c53c .cell execution_count=8}\n``` {.python .cell-code}\n# Load Linked Trips data from 2023 Household Travel Survey\ndf_hts_linked = client.query(\n    \"SELECT hh_id, PURP7_t, depart_per, model_trip_mode_WFv10, trip_weight FROM \" + 'wfrc-modeling-data.prd_tdm_hts_2023.trip_linked'\n).to_dataframe()\n\ndf_hts_linked\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>hh_id</th>\n      <th>PURP7_t</th>\n      <th>depart_per</th>\n      <th>model_trip_mode_WFv10</th>\n      <th>trip_weight</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>23009497</td>\n      <td>HBC</td>\n      <td>AM</td>\n      <td>auto-occ2</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>23153049</td>\n      <td>HBC</td>\n      <td>AM</td>\n      <td>drive-to-transit</td>\n      <td>29.247902</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>23183233</td>\n      <td>HBC</td>\n      <td>AM</td>\n      <td>walk-to-transit</td>\n      <td>8.413385</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>23003621</td>\n      <td>HBOth</td>\n      <td>AM</td>\n      <td>auto-occ3p</td>\n      <td>100.258156</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>23011441</td>\n      <td>HBOth</td>\n      <td>AM</td>\n      <td>bike</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>232446</th>\n      <td>23463507</td>\n      <td>NHBW</td>\n      <td>PM</td>\n      <td>auto-sov</td>\n      <td>16.681071</td>\n    </tr>\n    <tr>\n      <th>232447</th>\n      <td>23478596</td>\n      <td>NHBW</td>\n      <td>PM</td>\n      <td>auto-occ3p</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>232448</th>\n      <td>23481933</td>\n      <td>NHBW</td>\n      <td>PM</td>\n      <td>auto-sov</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>232449</th>\n      <td>23482195</td>\n      <td>NHBW</td>\n      <td>PM</td>\n      <td>walk</td>\n      <td>68.644470</td>\n    </tr>\n    <tr>\n      <th>232450</th>\n      <td>23494735</td>\n      <td>NHBW</td>\n      <td>PM</td>\n      <td>auto-sov</td>\n      <td>0.000000</td>\n    </tr>\n  </tbody>\n</table>\n<p>232451 rows √ó 5 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {#7bc60315 .cell execution_count=9}\n``` {.python .cell-code}\n# Load Household data from 2023 Household Travel Survey\ndf_hts_hh = client.query(\n    \"SELECT hh_id, num_vehicles_4cat FROM \" + 'wfrc-modeling-data.prd_tdm_hts_2023.hh'\n).to_dataframe()\n\ndf_hts_hh\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>hh_id</th>\n      <th>num_vehicles_4cat</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>23472690</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>23307416</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>23317145</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>23321176</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>23345703</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>11178</th>\n      <td>23165031</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>11179</th>\n      <td>23046966</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>11180</th>\n      <td>23043011</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>11181</th>\n      <td>23376736</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>11182</th>\n      <td>23085912</td>\n      <td>3</td>\n    </tr>\n  </tbody>\n</table>\n<p>11183 rows √ó 2 columns</p>\n</div>\n```\n:::\n:::\n\n\n# Understanding Mode Hierarchy\n\n```{mermaid}\nflowchart LR\n  T[\"üö¶ Total Trips\"]\n\n  %% Top-level split\n  T --> M[\"Motorized\"]\n  T --> NM[\"Non-motorized\"]\n\n  %% Motorized branch\n  subgraph S1[\"üöó Motorized Transportation\"]\n    direction TB\n    M --> A[\"Auto\"]\n    M --> TR[\"Transit\"]\n\n    %% Auto\n    A --> DA[\"Drive alone\"]\n    A --> SR[\"Shared ride\"]\n    SR --> SR2[\"SR2<br/><i>2 people</i>\"]\n    SR --> SR3[\"SR3<br/><i>3+ people</i>\"]\n\n    %% Transit (two complementary views)\n    subgraph S1a[\"üöå Transit ‚Äì By Service Type\"]\n      direction TB\n      TR --> TM[\"By service type\"]\n      TM --> LB[\"Local bus\"]\n      TM --> CB[\"Core bus\"]\n      TM --> EB[\"Express bus\"]\n      TM --> LRT[\"LRT<br/><i>light rail</i>\"]\n      TM --> CRT[\"CRT<br/><i>commuter rail</i>\"]\n      TM --> BRT[\"BRT<br/><i>bus rapid</i>\"]\n    end\n\n    subgraph S1b[\"üö∂üöó Transit ‚Äì By Access Type\"]\n      direction TB\n      TR --> TA[\"By access type\"]\n\n      %% Walk-to-transit\n      TA --> WTT[\"üö∂ Walk-to-transit\"]\n      WTT --> WLB[\"Walk ‚Üí Local bus\"]\n      WTT --> WCB[\"Walk ‚Üí Core bus\"]\n      WTT --> WEB[\"Walk ‚Üí Express bus\"]\n      WTT --> WLRT[\"Walk ‚Üí LRT\"]\n      WTT --> WCRT[\"Walk ‚Üí CRT\"]\n      WTT --> WBRT[\"Walk ‚Üí BRT\"]\n\n      %% Drive-to-transit\n      TA --> DTT[\"üöó Drive-to-transit\"]\n      DTT --> DLB[\"Drive ‚Üí Local bus\"]\n      DTT --> DCB[\"Drive ‚Üí Core bus\"]\n      DTT --> DEB[\"Drive ‚Üí Express bus\"]\n      DTT --> DLRT[\"Drive ‚Üí LRT\"]\n      DTT --> DCRT[\"Drive ‚Üí CRT\"]\n      DTT --> DBRT[\"Drive ‚Üí BRT\"]\n    end\n  end\n\n  %% Non-motorized branch\n  subgraph S2[\"üö∂ Non-motorized Transportation\"]\n    direction TB\n    NM --> WALK[\"Walk\"]\n    NM --> BIKE[\"Bike\"]\n  end\n\n  %% Styling\n  classDef rootNode fill:#2c3e50,stroke:#34495e,stroke-width:3px,color:#fff,font-weight:bold,font-size:16px\n  classDef motorizedNode fill:#3498db,stroke:#2980b9,stroke-width:2px,color:#fff,font-weight:bold\n  classDef nonMotorizedNode fill:#27ae60,stroke:#229954,stroke-width:2px,color:#fff,font-weight:bold\n  classDef autoNode fill:#e67e22,stroke:#d35400,stroke-width:2px,color:#fff\n  classDef transitNode fill:#9b59b6,stroke:#8e44ad,stroke-width:2px,color:#fff\n  classDef walkTransitNode fill:#1abc9c,stroke:#16a085,stroke-width:2px,color:#fff\n  classDef driveTransitNode fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:#fff\n  classDef leafNode fill:#ecf0f1,stroke:#95a5a6,stroke-width:1px,color:#2c3e50\n  classDef subgraphStyle fill:#f8f9fa,stroke:#dee2e6,stroke-width:2px\n\n  class T rootNode\n  class M motorizedNode\n  class NM nonMotorizedNode\n  class A,DA,SR,SR2,SR3 autoNode\n  class TR,TM,TA transitNode\n  class WTT,WLB,WCB,WEB,WLRT,WCRT,WBRT walkTransitNode\n  class DTT,DLB,DCB,DEB,DLRT,DCRT,DBRT driveTransitNode\n  class LB,CB,EB,LRT,CRT,BRT,WALK,BIKE leafNode\n```\n\n\n# Identify Variable of Interest\n\n## On-Board Survey\n\n::: {#6d2572e3 .cell execution_count=10}\n``` {.python .cell-code}\ndf_obs_linked[[\n    \"Linked_Mode_txt\", # Linked Mode: MT = MicroTransit (dont need), LCL = local bus, COR = Core Bus, EXP = Express Bus, LRT = Light Rail Transit (TRAX), CRT = Commuter Rail Transit (FrontRunner), BRT = Bus Rapid Transit (OVX, UVX)\n    \"Purp5_text\", # Trip Purpose: HBW = Home-based Work, HBO = Home-based Other, HBC = Home-based College, NHB = Non-home based, HBSch = Home-based School\n    \"PK_OK\", # Peak vs OffPeak\n    \"Veh_Cat3p\", # Vehicle Ownership: 0 = 0 Vehicle Household, 1 = 1 Vehicle Household, 2 = 2 Vehicle Household, 3 = 3+ Vehicle Household\n    \"Mode_Fin\", # Current Mode: 1 = MT = MicroTransit (Dont need),  4 = LCL = local bus, 5 = COR = Core Bus, 6 = EXP = Express Bus, 7 = LRT = Light Rail Transit (TRAX), 8 = CRT = Commuter Rail Transit, 9 = BRT = Bus Rapid Transit (OVX, UVX)\n    \"Ac_Mode_Model\", # Access Mode to Transit: Walk (Walk to Transit), Drive (Drive to Transit)\n]]\n```\n:::\n\n\n# Process HTS to get needed vars\n\nOBS has already been processed in OBS Prep repo. So, this section will only Process HTS data to get needed columns.\n\n## Purpose (5-category)\n\n::: {#be48e67d .cell execution_count=11}\n``` {.python .cell-code}\npurpose_mapping = {\n    'HBOth' : 'HBO',\n    'NHBNW' : 'NHB',\n    'HBW'   : 'HBW',\n    'NHBW'  : 'NHB',\n    'HBShp' : 'HBO',\n    'HBSch' : 'HBSch',\n    'HBC'   : 'HBC'\n}\n\ndf_hts_linked['Purp5_text'] = df_hts_linked['PURP7_t'].map(purpose_mapping)\n```\n:::\n\n\n## Vehicle Ownership\n\n::: {#e8505498 .cell execution_count=12}\n``` {.python .cell-code}\n# Join household data to linked trips data\ndf_hts_linked = df_hts_linked.merge(\n    df_hts_hh.rename(columns={'num_vehicles_4cat': 'Veh_Cat3p'}),\n    on='hh_id',\n    how='left'  # Keep all trips, even if household data is missing\n)\n\n# Rename the vehicle ownership column to match the OBS data\ndf_hts_linked = df_hts_linked.rename(columns={'num_vehicles_4cat': 'Veh_Cat3p'})\n```\n:::\n\n\n## Peak - Offpeak\n\n::: {#a69762b8 .cell execution_count=13}\n``` {.python .cell-code}\ndf_hts_linked['PK_OK'] = np.where(\n    df_hts_linked[\"depart_per\"].isin([\"AM\", \"PM\"]),\n    \"PK\",\n    \"OK\"\n)\n```\n:::\n\n\n# Data Exploration\n\n## Motorized vs Nonmotorized\n\n::: {#c12db5d6 .cell execution_count=14}\n``` {.python .cell-code}\n(\n    df_hts_linked[\n        (df_hts_linked['model_trip_mode_WFv10'].isin(\n            [\"auto-sov\", \"auto-occ2\", \"auto-occ3p\", \"walk-to-transit\",\n             \"drive-to-transit\", \"walk\", \"bike\"]\n        )) &\n        (df_hts_linked['Purp5_text'] == 'HBW')\n    ]\n    .assign(motorized_category=lambda x: x['model_trip_mode_WFv10'].map({\n        'auto-sov'         : 'motor',\n        'auto-occ2'        : 'motor',\n        'auto-occ3p'       : 'motor',\n        'walk-to-transit'  : 'motor',\n        'drive-to-transit' : 'motor',\n        'walk'             : 'nonmotor',\n        'bike'             : 'nonmotor'\n    }))\n    .groupby('motorized_category')['trip_weight']\n    .sum()\n    .pipe(lambda x: (x / x.sum() * 100).round(2))\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```\nmotorized_category\nmotor       97.03\nnonmotor     2.97\nName: trip_weight, dtype: float64\n```\n:::\n:::\n\n\n## HTS vs OBS Transit Trips\n\n### Filter for Transit Trips\n\n::: {#0ee89431 .cell execution_count=15}\n``` {.python .cell-code}\n# Identify transit trips in HTS\nhts_transit = df_hts_linked[\n    df_hts_linked['model_trip_mode_WFv10'].isin(['walk-to-transit', 'drive-to-transit'])\n].copy()\n\n# Filter out microtransit\nobs_transit = df_obs_linked[df_obs_linked['Linked_Mode_txt'] != 'MT'].copy()\n```\n:::\n\n\n### By access mode\n\n::: {#195fd65f .cell execution_count=16}\n``` {.python .cell-code}\nhts_by_access = hts_transit.groupby('model_trip_mode_WFv10')['trip_weight'].sum()\nhts_by_access\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```\nmodel_trip_mode_WFv10\ndrive-to-transit     34844.620753\nwalk-to-transit     106748.298633\nName: trip_weight, dtype: float64\n```\n:::\n:::\n\n\n::: {#95208936 .cell execution_count=17}\n``` {.python .cell-code}\nif 'Ac_Mode2_Model' in obs_transit.columns:\n    obs_by_access = obs_transit.groupby('Ac_Mode2_Model')['LINKED_WEIGHT'].sum().sort_index()\n\nobs_by_access\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```\nAc_Mode2_Model\nDrive    16854.909795\nWalk     75057.146738\nName: LINKED_WEIGHT, dtype: float64\n```\n:::\n:::\n\n\n### By purpose\n\n::: {#b0731784 .cell execution_count=18}\n``` {.python .cell-code}\nhts_by_purpose = hts_transit.groupby('Purp5_text')['trip_weight'].sum().sort_index()\nhts_by_purpose\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```\nPurp5_text\nHBC       9625.364706\nHBO      57055.318544\nHBSch     4709.043372\nHBW      41885.316622\nNHB      28317.876141\nName: trip_weight, dtype: float64\n```\n:::\n:::\n\n\n::: {#a2d766ba .cell execution_count=19}\n``` {.python .cell-code}\nobs_by_purpose = obs_transit.groupby('Purp5_text')['LINKED_WEIGHT'].sum().sort_index()\nobs_by_purpose\n```\n\n::: {.cell-output .cell-output-display execution_count=17}\n```\nPurp5_text\nHBC      17360.337763\nHBO      29495.641594\nHBSch     2506.365679\nHBW      34348.705422\nNHB       8201.006075\nName: LINKED_WEIGHT, dtype: float64\n```\n:::\n:::\n\n\n### By vehicle ownership\n\n::: {#5fcb6e54 .cell execution_count=20}\n``` {.python .cell-code}\nhts_by_veh = hts_transit.groupby('Veh_Cat3p')['trip_weight'].sum().sort_index()\nhts_by_veh\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```\nVeh_Cat3p\n0    41442.964546\n1    39084.528933\n2    37437.608191\n3    23627.817715\nName: trip_weight, dtype: float64\n```\n:::\n:::\n\n\n::: {#0b542f3a .cell execution_count=21}\n``` {.python .cell-code}\nobs_by_veh = obs_transit.groupby('Veh_Cat3p')['LINKED_WEIGHT'].sum().sort_index()\nobs_by_veh\n```\n\n::: {.cell-output .cell-output-display execution_count=19}\n```\nVeh_Cat3p\n0    27945.142654\n1    26587.638318\n2    22481.347636\n3    14897.927926\nName: LINKED_WEIGHT, dtype: float64\n```\n:::\n:::\n\n\n### By period\n\n::: {#2442a77b .cell execution_count=22}\n``` {.python .cell-code}\nhts_by_period = hts_transit.groupby('PK_OK')['trip_weight'].sum().sort_index()\nhts_by_period\n```\n\n::: {.cell-output .cell-output-display execution_count=20}\n```\nPK_OK\nOK    75439.954455\nPK    66152.964930\nName: trip_weight, dtype: float64\n```\n:::\n:::\n\n\n::: {#a38e35c4 .cell execution_count=23}\n``` {.python .cell-code}\nobs_by_period = obs_transit.groupby('PK_OK')['LINKED_WEIGHT'].sum().sort_index()\nobs_by_period\n```\n\n::: {.cell-output .cell-output-display execution_count=21}\n```\nPK_OK\nOK    54189.703255\nPK    37722.353279\nName: LINKED_WEIGHT, dtype: float64\n```\n:::\n:::\n\n\n### Summary\n\n::: {#a3aa8fa0 .cell execution_count=24}\n``` {.python .cell-code}\nprint(\"\\n\" + \"=\" * 80)\nprint(\"3. COMPARISON SUMMARY\")\nprint(\"=\" * 80)\n\nhts_total = hts_transit['trip_weight'].sum()\nobs_total = obs_transit['LINKED_WEIGHT'].sum()\nratio = obs_total / hts_total if hts_total > 0 else 0\n\nprint(f\"\\nHTS Daily Transit Trips:  {hts_total:>15,.1f}\")\nprint(f\"OBS Daily Transit Trips:  {obs_total:>15,.1f}\")\nprint(f\"{'‚îÄ' * 45}\")\nprint(f\"Ratio (OBS/HTS):          {ratio:>15.2f}x\")\nprint(f\"Difference:               {obs_total - hts_total:>15,.1f}\")\nprint(f\"% Difference:             {((obs_total/hts_total - 1) * 100):>15.1f}%\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n================================================================================\n3. COMPARISON SUMMARY\n================================================================================\n\nHTS Daily Transit Trips:        141,592.9\nOBS Daily Transit Trips:         91,912.1\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nRatio (OBS/HTS):                     0.65x\nDifference:                     -49,680.9\n% Difference:                       -35.1%\n```\n:::\n:::\n\n\n::: {#c3dc7417 .cell execution_count=25}\n``` {.python .cell-code}\nprint(\"\\n\" + \"=\" * 80)\nprint(\"4. DETAILED COMPARISON BY PURPOSE & PERIOD\")\nprint(\"=\" * 80)\n\n# Create comparison dataframe\ncomparison_data = []\n\nfor purpose in sorted(df_hts_linked['Purp5_text'].dropna().unique()):\n    for period in ['PK', 'OK']:\n        hts_val = hts_transit[\n            (hts_transit['Purp5_text'] == purpose) &\n            (hts_transit['PK_OK'] == period)\n        ]['trip_weight'].sum()\n\n        obs_val = obs_transit[\n            (obs_transit['Purp5_text'] == purpose) &\n            (obs_transit['PK_OK'] == period)\n        ]['LINKED_WEIGHT'].sum()\n\n        comparison_data.append({\n            'Purpose': purpose,\n            'Period': period,\n            'HTS_Trips': hts_val,\n            'OBS_Trips': obs_val,\n            'Ratio_OBS_HTS': obs_val / hts_val if hts_val > 0 else np.nan,\n            'Difference': obs_val - hts_val\n        })\n\ndf_comparison = pd.DataFrame(comparison_data)\ndf_comparison = df_comparison.sort_values(['Purpose', 'Period'])\n\nprint(\"\\n\")\nprint(df_comparison.to_string(index=False, float_format=lambda x: f'{x:,.2f}'))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n================================================================================\n4. DETAILED COMPARISON BY PURPOSE & PERIOD\n================================================================================\n\n\nPurpose Period  HTS_Trips  OBS_Trips  Ratio_OBS_HTS  Difference\n    HBC     OK   5,617.11  10,731.26           1.91    5,114.15\n    HBC     PK   4,008.25   6,629.08           1.65    2,620.83\n    HBO     OK  33,731.77  19,919.48           0.59  -13,812.28\n    HBO     PK  23,323.55   9,576.16           0.41  -13,747.40\n  HBSch     OK   1,472.00   1,289.22           0.88     -182.78\n  HBSch     PK   3,237.04   1,217.15           0.38   -2,019.90\n    HBW     OK  16,938.12  16,513.66           0.97     -424.46\n    HBW     PK  24,947.20  17,835.04           0.71   -7,112.15\n    NHB     OK  17,680.95   5,736.08           0.32  -11,944.88\n    NHB     PK  10,636.92   2,464.93           0.23   -8,171.99\n```\n:::\n:::\n\n\n## Create Hybrid Dataframes (HTS Auto/Non-motorized + OBS Transit)\n\n::: {#2fbc773d .cell execution_count=26}\n``` {.python .cell-code}\n# Non-motorized trips from HTS\ndf_hts_nonmotor = (\n    df_hts_linked[df_hts_linked['model_trip_mode_WFv10'].isin(['walk', 'bike'])]\n    [['Veh_Cat3p', 'Purp5_text', 'PK_OK', 'model_trip_mode_WFv10', 'trip_weight']]\n    .rename(columns={'trip_weight': 'weight', 'model_trip_mode_WFv10': 'mode'})\n)\n\ndf_hts_nonmotor\n```\n\n::: {.cell-output .cell-output-display execution_count=24}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Veh_Cat3p</th>\n      <th>Purp5_text</th>\n      <th>PK_OK</th>\n      <th>mode</th>\n      <th>weight</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>4</th>\n      <td>2</td>\n      <td>HBO</td>\n      <td>PK</td>\n      <td>bike</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>2</td>\n      <td>HBO</td>\n      <td>PK</td>\n      <td>walk</td>\n      <td>56.211497</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>3</td>\n      <td>HBO</td>\n      <td>PK</td>\n      <td>walk</td>\n      <td>8.639425</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>3</td>\n      <td>HBO</td>\n      <td>PK</td>\n      <td>walk</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>32</th>\n      <td>2</td>\n      <td>HBO</td>\n      <td>PK</td>\n      <td>walk</td>\n      <td>231.436200</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>232388</th>\n      <td>1</td>\n      <td>NHB</td>\n      <td>PK</td>\n      <td>walk</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>232421</th>\n      <td>2</td>\n      <td>NHB</td>\n      <td>PK</td>\n      <td>walk</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>232435</th>\n      <td>2</td>\n      <td>NHB</td>\n      <td>PK</td>\n      <td>walk</td>\n      <td>174.879696</td>\n    </tr>\n    <tr>\n      <th>232440</th>\n      <td>3</td>\n      <td>NHB</td>\n      <td>PK</td>\n      <td>bike</td>\n      <td>124.462152</td>\n    </tr>\n    <tr>\n      <th>232449</th>\n      <td>2</td>\n      <td>NHB</td>\n      <td>PK</td>\n      <td>walk</td>\n      <td>68.644470</td>\n    </tr>\n  </tbody>\n</table>\n<p>23112 rows √ó 5 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {#cc1ce6cb .cell execution_count=27}\n``` {.python .cell-code}\n# Auto trips from HTS\ndf_hts_auto = (\n    df_hts_linked[df_hts_linked['model_trip_mode_WFv10'].isin(['auto-sov', 'auto-occ2', 'auto-occ3p'])]\n    [['Veh_Cat3p', 'Purp5_text', 'PK_OK', 'model_trip_mode_WFv10', 'trip_weight']]\n    .rename(columns={'trip_weight': 'weight', 'model_trip_mode_WFv10': 'mode'})\n)\n\ndf_hts_auto\n```\n\n::: {.cell-output .cell-output-display execution_count=25}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Veh_Cat3p</th>\n      <th>Purp5_text</th>\n      <th>PK_OK</th>\n      <th>mode</th>\n      <th>weight</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>HBC</td>\n      <td>PK</td>\n      <td>auto-occ2</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>3</td>\n      <td>HBO</td>\n      <td>PK</td>\n      <td>auto-occ3p</td>\n      <td>100.258156</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>2</td>\n      <td>HBO</td>\n      <td>PK</td>\n      <td>auto-occ2</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>1</td>\n      <td>HBO</td>\n      <td>PK</td>\n      <td>auto-sov</td>\n      <td>39.258909</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>1</td>\n      <td>HBO</td>\n      <td>PK</td>\n      <td>auto-sov</td>\n      <td>466.377000</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>232445</th>\n      <td>2</td>\n      <td>NHB</td>\n      <td>PK</td>\n      <td>auto-sov</td>\n      <td>27.431127</td>\n    </tr>\n    <tr>\n      <th>232446</th>\n      <td>1</td>\n      <td>NHB</td>\n      <td>PK</td>\n      <td>auto-sov</td>\n      <td>16.681071</td>\n    </tr>\n    <tr>\n      <th>232447</th>\n      <td>1</td>\n      <td>NHB</td>\n      <td>PK</td>\n      <td>auto-occ3p</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>232448</th>\n      <td>3</td>\n      <td>NHB</td>\n      <td>PK</td>\n      <td>auto-sov</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>232450</th>\n      <td>1</td>\n      <td>NHB</td>\n      <td>PK</td>\n      <td>auto-sov</td>\n      <td>0.000000</td>\n    </tr>\n  </tbody>\n</table>\n<p>204676 rows √ó 5 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {#1c1822f6 .cell execution_count=28}\n``` {.python .cell-code}\n# Transit trips from OBS\ndf_obs_transit = (\n    df_obs_linked[df_obs_linked['Linked_Mode_txt'] != 'MT']\n    [['Veh_Cat3p', 'Purp5_text', 'PK_OK', 'Ac_Mode2_Model', 'LINKED_WEIGHT']]\n    .assign(mode=lambda x: x['Ac_Mode2_Model'].map({'Walk': 'walk-to-transit', 'Drive': 'drive-to-transit'}))\n    .rename(columns={'LINKED_WEIGHT': 'weight'})\n    [['Veh_Cat3p', 'Purp5_text', 'PK_OK', 'mode', 'weight']]\n)\n\ndf_obs_transit\n```\n\n::: {.cell-output .cell-output-display execution_count=26}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Veh_Cat3p</th>\n      <th>Purp5_text</th>\n      <th>PK_OK</th>\n      <th>mode</th>\n      <th>weight</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>0</td>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>walk-to-transit</td>\n      <td>6.684644</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0</td>\n      <td>HBC</td>\n      <td>OK</td>\n      <td>walk-to-transit</td>\n      <td>3.141403</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1</td>\n      <td>HBO</td>\n      <td>OK</td>\n      <td>drive-to-transit</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2</td>\n      <td>HBW</td>\n      <td>OK</td>\n      <td>drive-to-transit</td>\n      <td>4.539259</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0</td>\n      <td>HBW</td>\n      <td>OK</td>\n      <td>walk-to-transit</td>\n      <td>7.452233</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>13790</th>\n      <td>1</td>\n      <td>HBO</td>\n      <td>OK</td>\n      <td>walk-to-transit</td>\n      <td>6.068780</td>\n    </tr>\n    <tr>\n      <th>13791</th>\n      <td>0</td>\n      <td>NHB</td>\n      <td>OK</td>\n      <td>walk-to-transit</td>\n      <td>11.674594</td>\n    </tr>\n    <tr>\n      <th>13792</th>\n      <td>1</td>\n      <td>NHB</td>\n      <td>OK</td>\n      <td>walk-to-transit</td>\n      <td>5.837297</td>\n    </tr>\n    <tr>\n      <th>13793</th>\n      <td>3</td>\n      <td>HBC</td>\n      <td>OK</td>\n      <td>walk-to-transit</td>\n      <td>4.635576</td>\n    </tr>\n    <tr>\n      <th>13794</th>\n      <td>1</td>\n      <td>HBW</td>\n      <td>OK</td>\n      <td>walk-to-transit</td>\n      <td>3.327445</td>\n    </tr>\n  </tbody>\n</table>\n<p>13732 rows √ó 5 columns</p>\n</div>\n```\n:::\n:::\n\n\n# Trips: Motorized vs Non-motorized\n\n::: {#5029f17e .cell execution_count=29}\n``` {.python .cell-code}\n# 1. All Trips: Motorized vs Non-motorized\nprint(\"\\n\" + \"=\" * 60)\nprint(\"1. ALL TRIPS: MOTORIZED VS NON-MOTORIZED\")\nprint(\"=\" * 60)\n\ndf_alltrips_hybrid = pd.concat([\n    df_hts_auto.assign(mode_category='motor'),\n    df_obs_transit.assign(mode_category='motor'),\n    df_hts_nonmotor.assign(mode_category='nonmotor')\n], ignore_index=True)\n\ndf_alltrips_cat = calculate_categorical_shares(\n    df_alltrips_hybrid,\n    category_col='mode_category',\n    weight_col='weight',\n    group_cols=['Veh_Cat3p', 'Purp5_text', 'PK_OK'],\n    filter_condition=None,\n    category_mapping=None,\n    prefix='calib_share'\n)\n\nprint(\"\\nShape:\", df_alltrips_cat.shape)\nprint(\"\\nFirst few rows:\")\nprint(df_alltrips_cat.head(10))\nprint(\"\\nVerification:\")\nverify_shares(df_alltrips_cat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\n1. ALL TRIPS: MOTORIZED VS NON-MOTORIZED\n============================================================\n\nShape: (10, 8)\n\nFirst few rows:\n                                HBO                 HBW                 NHB  \\\n                                 OK        PK        OK        PK        OK   \ncalib_share_motor_0veh     0.533230  0.708080  0.651913  0.681340  0.587940   \ncalib_share_motor_1veh     0.914938  0.906430  0.961087  0.952791  0.916491   \ncalib_share_motor_2veh     0.928832  0.925366  0.964527  0.976689  0.917140   \ncalib_share_motor_3veh     0.960161  0.962811  0.982518  0.987456  0.934527   \ncalib_share_motor_all      0.933122  0.933902  0.963199  0.975350  0.919808   \ncalib_share_nonmotor_0veh  0.466770  0.291920  0.348087  0.318660  0.412060   \ncalib_share_nonmotor_1veh  0.085062  0.093570  0.038913  0.047209  0.083509   \ncalib_share_nonmotor_2veh  0.071168  0.074634  0.035473  0.023311  0.082860   \ncalib_share_nonmotor_3veh  0.039839  0.037189  0.017482  0.012544  0.065473   \ncalib_share_nonmotor_all   0.066878  0.066098  0.036801  0.024650  0.080192   \n\n                                          HBC     HBSch  \n                                 PK     Daily     Daily  \ncalib_share_motor_0veh     0.602040  0.390497  0.159682  \ncalib_share_motor_1veh     0.911420  0.782534  0.766884  \ncalib_share_motor_2veh     0.934565  0.816434  0.793119  \ncalib_share_motor_3veh     0.952616  0.830851  0.845669  \ncalib_share_motor_all      0.934797  0.770927  0.812666  \ncalib_share_nonmotor_0veh  0.397960  0.609503  0.840318  \ncalib_share_nonmotor_1veh  0.088580  0.217466  0.233116  \ncalib_share_nonmotor_2veh  0.065435  0.183566  0.206881  \ncalib_share_nonmotor_3veh  0.047384  0.169149  0.154331  \ncalib_share_nonmotor_all   0.065203  0.229073  0.187334  \n\nVerification:\n=== Verifying Share Sums ===\n\nVehicle categories found: ['0veh', '1veh', '2veh', '3veh', 'all']\n\n--- Checking 0veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 0veh\n\n--- Checking 1veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 1veh\n\n--- Checking 2veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 2veh\n\n--- Checking 3veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 3veh\n\n--- Checking all (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for all\n\n============================================================\n‚úÖ ALL VEHICLE CATEGORIES: Shares sum to 1.0 (within tolerance)\n\nTotal columns: 8\nTotal vehicle categories: 5\nTotal combinations: 40\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=27}\n```\n{'0veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '1veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '2veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '3veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n 'all': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64}\n```\n:::\n:::\n\n\n## Non-motorized Trips: Walk vs Bike\n\n::: {#568d6102 .cell execution_count=30}\n``` {.python .cell-code}\n# 2. NON-MOTORIZED TRIPS\nprint(\"\\n\" + \"=\" * 60)\nprint(\"2. NON-MOTORIZED TRIPS\")\nprint(\"=\" * 60)\n\n# non_motorized_mapping = {\n#     'walk' : 'walk',\n#     'bike' : 'bike'\n# }\n\ndf_nonmotorized_cat = calculate_categorical_shares(\n    df_hts_linked,\n    category_col='model_trip_mode_WFv10',\n    weight_col='trip_weight',\n    group_cols=['Veh_Cat3p', 'Purp5_text', 'PK_OK'],\n    filter_condition='model_trip_mode_WFv10 in [\"walk\", \"bike\"]',\n    category_mapping=None,\n    prefix='calib_share'\n)\n\nprint(\"\\nShape:\", df_nonmotorized_cat.shape)\nprint(\"\\nFirst few rows:\")\nprint(df_nonmotorized_cat.head(10))\nprint(\"\\nVerification:\")\nverify_shares(df_nonmotorized_cat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\n2. NON-MOTORIZED TRIPS\n============================================================\n\nShape: (10, 8)\n\nFirst few rows:\n                            HBO                 HBW                 NHB  \\\n                             OK        PK        OK        PK        OK   \ncalib_share_bike_0veh  0.093370  0.081922  0.126895  0.184947  0.096749   \ncalib_share_bike_1veh  0.141585  0.107295  0.225268  0.300143  0.100676   \ncalib_share_bike_2veh  0.104966  0.139940  0.338888  0.382897  0.076727   \ncalib_share_bike_3veh  0.131393  0.033276  0.110195  0.564415  0.056874   \ncalib_share_bike_all   0.117384  0.107575  0.215958  0.377379  0.076507   \ncalib_share_walk_0veh  0.906630  0.918078  0.873105  0.815053  0.903251   \ncalib_share_walk_1veh  0.858415  0.892705  0.774732  0.699857  0.899324   \ncalib_share_walk_2veh  0.895034  0.860060  0.661112  0.617103  0.923273   \ncalib_share_walk_3veh  0.868607  0.966724  0.889805  0.435585  0.943126   \ncalib_share_walk_all   0.882616  0.892425  0.784042  0.622621  0.923493   \n\n                                    HBSch       HBC  \n                             PK     Daily     Daily  \ncalib_share_bike_0veh  0.168994  0.023156  0.007745  \ncalib_share_bike_1veh  0.110790  0.135214  0.167210  \ncalib_share_bike_2veh  0.074370  0.107164  0.101549  \ncalib_share_bike_3veh  0.076972  0.103986  0.000000  \ncalib_share_bike_all   0.088079  0.107922  0.063449  \ncalib_share_walk_0veh  0.831006  0.976844  0.992255  \ncalib_share_walk_1veh  0.889210  0.864786  0.832790  \ncalib_share_walk_2veh  0.925630  0.892836  0.898451  \ncalib_share_walk_3veh  0.923028  0.896014  1.000000  \ncalib_share_walk_all   0.911921  0.892078  0.936551  \n\nVerification:\n=== Verifying Share Sums ===\n\nVehicle categories found: ['0veh', '1veh', '2veh', '3veh', 'all']\n\n--- Checking 0veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 0veh\n\n--- Checking 1veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 1veh\n\n--- Checking 2veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 2veh\n\n--- Checking 3veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 3veh\n\n--- Checking all (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for all\n\n============================================================\n‚úÖ ALL VEHICLE CATEGORIES: Shares sum to 1.0 (within tolerance)\n\nTotal columns: 8\nTotal vehicle categories: 5\nTotal combinations: 40\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=28}\n```\n{'0veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBSch  Daily    1.0\n HBC    Daily    1.0\n dtype: float64,\n '1veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBSch  Daily    1.0\n HBC    Daily    1.0\n dtype: float64,\n '2veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBSch  Daily    1.0\n HBC    Daily    1.0\n dtype: float64,\n '3veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBSch  Daily    1.0\n HBC    Daily    1.0\n dtype: float64,\n 'all': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBSch  Daily    1.0\n HBC    Daily    1.0\n dtype: float64}\n```\n:::\n:::\n\n\n## Motorized Trips: Auto vs Transit\n\n::: {#6dc4e6fe .cell execution_count=31}\n``` {.python .cell-code}\n# 3. Motorized Trips: Auto vs Transit\nprint(\"\\n\" + \"=\" * 60)\nprint(\"3. MOTORIZED TRIPS: AUTO VS TRANSIT\")\nprint(\"=\" * 60)\n\ndf_motorized_hybrid = pd.concat([\n    df_hts_auto.assign(mode_category='auto'),\n    df_obs_transit.assign(mode_category='transit')\n], ignore_index=True)\n\ndf_motorized_cat = calculate_categorical_shares(\n    df_motorized_hybrid,\n    category_col='mode_category',\n    weight_col='weight',\n    group_cols=['Veh_Cat3p', 'Purp5_text', 'PK_OK'],\n    filter_condition=None,\n    category_mapping=None,\n    prefix='calib_share'\n)\n\nprint(\"\\nShape:\", df_motorized_cat.shape)\nprint(\"\\nFirst few rows:\")\nprint(df_motorized_cat.head(10))\nprint(\"\\nVerification:\")\nverify_shares(df_motorized_cat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\n3. MOTORIZED TRIPS: AUTO VS TRANSIT\n============================================================\n\nShape: (10, 8)\n\nFirst few rows:\n                               HBO                 HBW                 NHB  \\\n                                OK        PK        OK        PK        OK   \ncalib_share_auto_0veh     0.730837  0.856214  0.740269  0.503249  0.848197   \ncalib_share_auto_1veh     0.992607  0.994069  0.963498  0.964905  0.996352   \ncalib_share_auto_2veh     0.997798  0.998141  0.988919  0.990905  0.998797   \ncalib_share_auto_3veh     0.998297  0.998997  0.993981  0.996109  0.999100   \ncalib_share_auto_all      0.995284  0.996582  0.982687  0.986422  0.997388   \ncalib_share_transit_0veh  0.269163  0.143786  0.259731  0.496751  0.151803   \ncalib_share_transit_1veh  0.007393  0.005931  0.036502  0.035095  0.003648   \ncalib_share_transit_2veh  0.002202  0.001859  0.011081  0.009095  0.001203   \ncalib_share_transit_3veh  0.001703  0.001003  0.006019  0.003891  0.000900   \ncalib_share_transit_all   0.004716  0.003418  0.017313  0.013578  0.002612   \n\n                                         HBC     HBSch  \n                                PK     Daily     Daily  \ncalib_share_auto_0veh     0.821281  0.321973  0.347803  \ncalib_share_auto_1veh     0.997401  0.769693  0.983710  \ncalib_share_auto_2veh     0.999237  0.858025  0.996398  \ncalib_share_auto_3veh     0.999378  0.871850  0.998431  \ncalib_share_auto_all      0.998200  0.815798  0.995782  \ncalib_share_transit_0veh  0.178719  0.678027  0.652197  \ncalib_share_transit_1veh  0.002599  0.230307  0.016290  \ncalib_share_transit_2veh  0.000763  0.141975  0.003602  \ncalib_share_transit_3veh  0.000622  0.128150  0.001569  \ncalib_share_transit_all   0.001800  0.184202  0.004218  \n\nVerification:\n=== Verifying Share Sums ===\n\nVehicle categories found: ['0veh', '1veh', '2veh', '3veh', 'all']\n\n--- Checking 0veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 0veh\n\n--- Checking 1veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 1veh\n\n--- Checking 2veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 2veh\n\n--- Checking 3veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 3veh\n\n--- Checking all (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for all\n\n============================================================\n‚úÖ ALL VEHICLE CATEGORIES: Shares sum to 1.0 (within tolerance)\n\nTotal columns: 8\nTotal vehicle categories: 5\nTotal combinations: 40\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=29}\n```\n{'0veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '1veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '2veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '3veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n 'all': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64}\n```\n:::\n:::\n\n\n### Auto Trips: Drive Alone vs Shared Rides\n\n::: {#09fb6ae9 .cell execution_count=32}\n``` {.python .cell-code}\n# 4. Auto Trips: Drive Alone vs Shared Rides\nprint(\"\\n\" + \"=\" * 60)\nprint(\"4. AUTO TRIPS: DRIVE ALONE VS SHARED RIDES\")\nprint(\"=\" * 60)\n\nauto_ride_mapping = {\n    'auto-sov'   : 'alone',\n    'auto-occ2'  : 'shared',\n    'auto-occ3p' : 'shared'\n}\n\ndf_auto_riders = calculate_categorical_shares(\n    df_hts_linked,\n    category_col='model_trip_mode_WFv10',\n    weight_col='trip_weight',\n    group_cols=['Veh_Cat3p', 'Purp5_text', 'PK_OK'],\n    filter_condition='model_trip_mode_WFv10 in [\"auto-sov\", \"auto-occ2\", \"auto-occ3p\"]',\n    category_mapping=auto_ride_mapping,\n    prefix='calib_share'\n)\n\nprint(\"\\nShape:\", df_auto_riders.shape)\nprint(\"\\nFirst few rows:\")\nprint(df_auto_riders.head(10))\nprint(\"\\nVerification:\")\nverify_shares(df_auto_riders)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\n4. AUTO TRIPS: DRIVE ALONE VS SHARED RIDES\n============================================================\n\nShape: (10, 8)\n\nFirst few rows:\n                              HBO                 HBW                 NHB  \\\n                               OK        PK        OK        PK        OK   \ncalib_share_alone_0veh   0.231886  0.134755  0.251145  0.206815  0.214780   \ncalib_share_alone_1veh   0.450430  0.422546  0.743629  0.767954  0.464611   \ncalib_share_alone_2veh   0.343353  0.306012  0.849545  0.875657  0.393618   \ncalib_share_alone_3veh   0.409285  0.362711  0.866645  0.895452  0.471189   \ncalib_share_alone_all    0.384813  0.343298  0.833347  0.868592  0.434965   \ncalib_share_shared_0veh  0.768114  0.865245  0.748855  0.793185  0.785220   \ncalib_share_shared_1veh  0.549570  0.577454  0.256371  0.232046  0.535389   \ncalib_share_shared_2veh  0.656647  0.693988  0.150455  0.124343  0.606382   \ncalib_share_shared_3veh  0.590715  0.637289  0.133355  0.104548  0.528811   \ncalib_share_shared_all   0.615187  0.656702  0.166653  0.131408  0.565035   \n\n                                        HBC     HBSch  \n                               PK     Daily     Daily  \ncalib_share_alone_0veh   0.361057  0.365629  0.000000  \ncalib_share_alone_1veh   0.516010  0.476547  0.041826  \ncalib_share_alone_2veh   0.411229  0.825620  0.030260  \ncalib_share_alone_3veh   0.471706  0.771353  0.190596  \ncalib_share_alone_all    0.452998  0.718980  0.108671  \ncalib_share_shared_0veh  0.638943  0.634371  1.000000  \ncalib_share_shared_1veh  0.483990  0.523453  0.958174  \ncalib_share_shared_2veh  0.588771  0.174380  0.969740  \ncalib_share_shared_3veh  0.528294  0.228647  0.809404  \ncalib_share_shared_all   0.547002  0.281020  0.891329  \n\nVerification:\n=== Verifying Share Sums ===\n\nVehicle categories found: ['0veh', '1veh', '2veh', '3veh', 'all']\n\n--- Checking 0veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 0veh\n\n--- Checking 1veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 1veh\n\n--- Checking 2veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 2veh\n\n--- Checking 3veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 3veh\n\n--- Checking all (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for all\n\n============================================================\n‚úÖ ALL VEHICLE CATEGORIES: Shares sum to 1.0 (within tolerance)\n\nTotal columns: 8\nTotal vehicle categories: 5\nTotal combinations: 40\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=30}\n```\n{'0veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '1veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '2veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '3veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n 'all': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64}\n```\n:::\n:::\n\n\n#### Shared Rides: 2 People vs 3+ People\n\n::: {#db1bd1be .cell execution_count=33}\n``` {.python .cell-code}\n# 5. Shared Ride by the Number of People\nprint(\"\\n\" + \"=\" * 60)\nprint(\"5. SHARED RIDER BY NUMBER OF PEOPLE\")\nprint(\"=\" * 60)\n\nshared_ride_mapping = {\n    'auto-occ2' : 'sr2',\n    'auto-occ3p': 'sr3'\n}\n\ndf_shared_by_person = calculate_categorical_shares(\n    df_hts_linked,\n    category_col='model_trip_mode_WFv10',\n    weight_col='trip_weight',\n    group_cols=['Veh_Cat3p', 'Purp5_text', 'PK_OK'],\n    filter_condition='model_trip_mode_WFv10 in [\"auto-occ2\", \"auto-occ3p\"]',\n    category_mapping=shared_ride_mapping,\n    prefix='calib_share'\n)\n\nprint(\"\\nShape:\", df_shared_by_person.shape)\nprint(\"\\nFirst few rows:\")\nprint(df_shared_by_person.head(10))\nprint(\"\\nVerification:\")\nverify_shares(df_shared_by_person)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\n5. SHARED RIDER BY NUMBER OF PEOPLE\n============================================================\n\nShape: (10, 8)\n\nFirst few rows:\n                           HBO                 HBW                 NHB  \\\n                            OK        PK        OK        PK        OK   \ncalib_share_sr2_0veh  0.709382  0.289280  0.731697  0.857568  0.740220   \ncalib_share_sr2_1veh  0.565882  0.518618  0.726008  0.795799  0.551582   \ncalib_share_sr2_2veh  0.512200  0.461630  0.792496  0.756507  0.458916   \ncalib_share_sr2_3veh  0.574960  0.531453  0.784871  0.702538  0.517496   \ncalib_share_sr2_all   0.543836  0.493188  0.770847  0.747774  0.498240   \ncalib_share_sr3_0veh  0.290618  0.710720  0.268303  0.142432  0.259780   \ncalib_share_sr3_1veh  0.434118  0.481382  0.273992  0.204201  0.448418   \ncalib_share_sr3_2veh  0.487800  0.538370  0.207504  0.243493  0.541084   \ncalib_share_sr3_3veh  0.425040  0.468547  0.215129  0.297462  0.482504   \ncalib_share_sr3_all   0.456164  0.506812  0.229153  0.252226  0.501760   \n\n                                     HBC     HBSch  \n                            PK     Daily     Daily  \ncalib_share_sr2_0veh  0.785824  0.950890  0.000000  \ncalib_share_sr2_1veh  0.509631  0.707841  0.308240  \ncalib_share_sr2_2veh  0.458682  0.968752  0.298725  \ncalib_share_sr2_3veh  0.493538  0.582443  0.437045  \ncalib_share_sr2_all   0.480974  0.733967  0.360179  \ncalib_share_sr3_0veh  0.214176  0.049110  1.000000  \ncalib_share_sr3_1veh  0.490369  0.292159  0.691760  \ncalib_share_sr3_2veh  0.541318  0.031248  0.701275  \ncalib_share_sr3_3veh  0.506462  0.417557  0.562955  \ncalib_share_sr3_all   0.519026  0.266033  0.639821  \n\nVerification:\n=== Verifying Share Sums ===\n\nVehicle categories found: ['0veh', '1veh', '2veh', '3veh', 'all']\n\n--- Checking 0veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 0veh\n\n--- Checking 1veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 1veh\n\n--- Checking 2veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 2veh\n\n--- Checking 3veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 3veh\n\n--- Checking all (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for all\n\n============================================================\n‚úÖ ALL VEHICLE CATEGORIES: Shares sum to 1.0 (within tolerance)\n\nTotal columns: 8\nTotal vehicle categories: 5\nTotal combinations: 40\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=31}\n```\n{'0veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '1veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '2veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '3veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n 'all': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64}\n```\n:::\n:::\n\n\n### Transit Trips: By Service and By Access Mode\n\n#### By Service Type\n\n::: {#c473aa83 .cell execution_count=34}\n``` {.python .cell-code}\n# 6. Transit by Service Type (within linked transit trips)\nprint(\"\\n\" + \"=\" * 60)\nprint(\"6. TRANSIT BY SERVICE TYPE\")\nprint(\"=\" * 60)\n\nservice_mapping = {\n    'LCL': 'local',\n    'COR': 'core',\n    'EXP': 'express',\n    'LRT': 'lrt',\n    'CRT': 'crt',\n    'BRT': 'brt'\n}\n\ndf_transit_by_service = calculate_categorical_shares(\n    df_obs_linked,\n    category_col='Linked_Mode_txt',\n    weight_col='LINKED_WEIGHT',\n    group_cols=['Veh_Cat3p', 'Purp5_text', 'PK_OK'],\n    filter_condition='Linked_Mode_txt != \"MT\"',\n    category_mapping=service_mapping,\n    prefix='calib_share'\n)\n\nprint(\"\\nShape:\", df_transit_by_service.shape)\nprint(\"\\nFirst few rows:\")\nprint(df_transit_by_service.head(10))\nprint(\"\\nVerification:\")\nverify_shares(df_transit_by_service)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\n6. TRANSIT BY SERVICE TYPE\n============================================================\n\nShape: (25, 8)\n\nFirst few rows:\n                           HBO                 HBW                 NHB  \\\n                            OK        PK        OK        PK        OK   \ncalib_share_brt_0veh  0.093057  0.096456  0.047473  0.095224  0.153395   \ncalib_share_brt_1veh  0.089342  0.054748  0.046183  0.032496  0.148609   \ncalib_share_brt_2veh  0.048919  0.038212  0.028291  0.050144  0.219395   \ncalib_share_brt_3veh  0.069251  0.077194  0.045087  0.046860  0.183415   \ncalib_share_brt_all   0.079479  0.069215  0.042054  0.055455  0.169141   \ncalib_share_crt_0veh  0.050399  0.046084  0.062668  0.066167  0.032120   \ncalib_share_crt_1veh  0.108913  0.108609  0.131166  0.173338  0.079517   \ncalib_share_crt_2veh  0.162660  0.143757  0.185038  0.233631  0.073834   \ncalib_share_crt_3veh  0.188749  0.205590  0.257891  0.309838  0.055098   \ncalib_share_crt_all   0.107888  0.104278  0.144566  0.179742  0.055664   \n\n                                     HBC     HBSch  \n                            PK     Daily     Daily  \ncalib_share_brt_0veh  0.123222  0.270885  0.015133  \ncalib_share_brt_1veh  0.087382  0.280118  0.047447  \ncalib_share_brt_2veh  0.050852  0.191436  0.058813  \ncalib_share_brt_3veh  0.133186  0.237051  0.071987  \ncalib_share_brt_all   0.101817  0.243896  0.052479  \ncalib_share_crt_0veh  0.020874  0.077904  0.000000  \ncalib_share_crt_1veh  0.188967  0.133831  0.014499  \ncalib_share_crt_2veh  0.073795  0.193403  0.078049  \ncalib_share_crt_3veh  0.177490  0.217306  0.131698  \ncalib_share_crt_all   0.095124  0.161091  0.057136  \n\nVerification:\n=== Verifying Share Sums ===\n\nVehicle categories found: ['0veh', '1veh', '2veh', '3veh', 'all']\n\n--- Checking 0veh (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for 0veh\n\n--- Checking 1veh (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for 1veh\n\n--- Checking 2veh (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for 2veh\n\n--- Checking 3veh (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for 3veh\n\n--- Checking all (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for all\n\n============================================================\n‚úÖ ALL VEHICLE CATEGORIES: Shares sum to 1.0 (within tolerance)\n\nTotal columns: 8\nTotal vehicle categories: 5\nTotal combinations: 40\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=32}\n```\n{'0veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '1veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '2veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '3veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n 'all': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64}\n```\n:::\n:::\n\n\n#### By Access Mode: Walk vs Drive to Transit\n\n::: {#aaed1309 .cell execution_count=35}\n``` {.python .cell-code}\n# 7. Transit by Access Type (Walk vs Drive) (within linked transit trips)\nprint(\"\\n\" + \"=\" * 60)\nprint(\"7. TRANSIT BY ACCESS TYPE\")\nprint(\"=\" * 60)\n\naccess_mapping = {\n    'Walk': 'walkacc',\n    'Drive': 'driveacc'\n}\n\ndf_transit_by_access = calculate_categorical_shares(\n    df_obs_linked,\n    category_col='Ac_Mode2_Model',\n    weight_col='LINKED_WEIGHT',\n    group_cols=['Veh_Cat3p', 'Purp5_text', 'PK_OK'],\n    filter_condition='Linked_Mode_txt != \"MT\"',\n    category_mapping=access_mapping,\n    prefix='calib_share'\n)\n\nprint(\"\\nShape:\", df_transit_by_access.shape)\nprint(\"\\nFirst few rows:\")\nprint(df_transit_by_access.head(10))\nprint(\"\\nVerification:\")\nverify_shares(df_transit_by_access)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\n7. TRANSIT BY ACCESS TYPE\n============================================================\n\nShape: (10, 8)\n\nFirst few rows:\n                                HBO                 HBW                 NHB  \\\n                                 OK        PK        OK        PK        OK   \ncalib_share_driveacc_0veh  0.042043  0.041143  0.040632  0.044171  0.056313   \ncalib_share_driveacc_1veh  0.121467  0.141475  0.148949  0.206870  0.045113   \ncalib_share_driveacc_2veh  0.173299  0.202267  0.269593  0.365426  0.025015   \ncalib_share_driveacc_3veh  0.256207  0.246329  0.414853  0.422377  0.037477   \ncalib_share_driveacc_all   0.119140  0.129893  0.189060  0.235858  0.044757   \ncalib_share_walkacc_0veh   0.957957  0.958857  0.959368  0.955829  0.943687   \ncalib_share_walkacc_1veh   0.878533  0.858525  0.851051  0.793130  0.954887   \ncalib_share_walkacc_2veh   0.826701  0.797733  0.730407  0.634574  0.974985   \ncalib_share_walkacc_3veh   0.743793  0.753671  0.585147  0.577623  0.962523   \ncalib_share_walkacc_all    0.880860  0.870107  0.810940  0.764142  0.955243   \n\n                                          HBC     HBSch  \n                                 PK     Daily     Daily  \ncalib_share_driveacc_0veh  0.023835  0.034826  0.018714  \ncalib_share_driveacc_1veh  0.081784  0.216398  0.079303  \ncalib_share_driveacc_2veh  0.091050  0.353965  0.161519  \ncalib_share_driveacc_3veh  0.102363  0.524908  0.136143  \ncalib_share_driveacc_all   0.061683  0.300534  0.112939  \ncalib_share_walkacc_0veh   0.976165  0.965174  0.981286  \ncalib_share_walkacc_1veh   0.918216  0.783602  0.920697  \ncalib_share_walkacc_2veh   0.908950  0.646035  0.838481  \ncalib_share_walkacc_3veh   0.897637  0.475092  0.863857  \ncalib_share_walkacc_all    0.938317  0.699466  0.887061  \n\nVerification:\n=== Verifying Share Sums ===\n\nVehicle categories found: ['0veh', '1veh', '2veh', '3veh', 'all']\n\n--- Checking 0veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 0veh\n\n--- Checking 1veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 1veh\n\n--- Checking 2veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 2veh\n\n--- Checking 3veh (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for 3veh\n\n--- Checking all (2 categories) ---\n  ‚úÖ All shares sum to 1.0 for all\n\n============================================================\n‚úÖ ALL VEHICLE CATEGORIES: Shares sum to 1.0 (within tolerance)\n\nTotal columns: 8\nTotal vehicle categories: 5\nTotal combinations: 40\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=33}\n```\n{'0veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '1veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '2veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '3veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n 'all': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64}\n```\n:::\n:::\n\n\n##### Walk to Transit\n\n::: {#dcf89dc9 .cell execution_count=36}\n``` {.python .cell-code}\n# 8. Walk-to-Transit by Service Type (within walk-to-transit trips)\nprint(\"\\n\" + \"=\" * 60)\nprint(\"8. WALK-TO-TRANSIT BY SERVICE TYPE\")\nprint(\"=\" * 60)\n\nwalk_service_mapping = {\n    'LCL': 'wlocal',\n    'EXP': 'wexpress',\n    'LRT': 'wlrt',\n    'CRT': 'wcrt',\n    'BRT': 'wbrt'\n}\n\ndf_walk_to_transit = calculate_categorical_shares(\n    df_obs_linked,\n    category_col='Linked_Mode_txt',\n    weight_col='LINKED_WEIGHT',\n    group_cols=['Veh_Cat3p', 'Purp5_text', 'PK_OK'],\n    filter_condition='Ac_Mode2_Model == \"Walk\" & Linked_Mode_txt != \"MT\"',\n    category_mapping=walk_service_mapping,\n    prefix='calib_share'\n)\n\n\nprint(\"\\nShape:\", df_walk_to_transit.shape)\nprint(\"\\nFirst few rows:\")\nprint(df_walk_to_transit.head(10))\nprint(\"\\nVerification:\")\nverify_shares(df_walk_to_transit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\n8. WALK-TO-TRANSIT BY SERVICE TYPE\n============================================================\n\nShape: (25, 8)\n\nFirst few rows:\n                            HBO                 HBW                 NHB  \\\n                             OK        PK        OK        PK        OK   \ncalib_share_wbrt_0veh  0.097142  0.100595  0.049484  0.099624  0.157465   \ncalib_share_wbrt_1veh  0.101694  0.063769  0.054266  0.039404  0.155630   \ncalib_share_wbrt_2veh  0.059173  0.047900  0.038733  0.060280  0.218994   \ncalib_share_wbrt_3veh  0.089317  0.096841  0.061895  0.081126  0.190556   \ncalib_share_wbrt_all   0.089796  0.079002  0.050130  0.067799  0.173773   \ncalib_share_wcrt_0veh  0.038325  0.033586  0.058874  0.056573  0.017703   \ncalib_share_wcrt_1veh  0.050163  0.047245  0.086122  0.089959  0.064832   \ncalib_share_wcrt_2veh  0.088223  0.059357  0.095408  0.089008  0.056101   \ncalib_share_wcrt_3veh  0.048907  0.077577  0.090973  0.180144  0.024711   \ncalib_share_wcrt_all   0.052514  0.047197  0.079453  0.087829  0.038608   \n\n                                      HBC     HBSch  \n                             PK     Daily     Daily  \ncalib_share_wbrt_0veh  0.126230  0.280659  0.015421  \ncalib_share_wbrt_1veh  0.095165  0.289213  0.025199  \ncalib_share_wbrt_2veh  0.055945  0.205743  0.062380  \ncalib_share_wbrt_3veh  0.148374  0.248898  0.083332  \ncalib_share_wbrt_all   0.108510  0.259711  0.047005  \ncalib_share_wcrt_0veh  0.021384  0.052249  0.000000  \ncalib_share_wcrt_1veh  0.149215  0.053229  0.002169  \ncalib_share_wcrt_2veh  0.051479  0.075014  0.019002  \ncalib_share_wcrt_3veh  0.123171  0.094045  0.009820  \ncalib_share_wcrt_all   0.072236  0.065616  0.009058  \n\nVerification:\n=== Verifying Share Sums ===\n\nVehicle categories found: ['0veh', '1veh', '2veh', '3veh', 'all']\n\n--- Checking 0veh (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for 0veh\n\n--- Checking 1veh (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for 1veh\n\n--- Checking 2veh (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for 2veh\n\n--- Checking 3veh (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for 3veh\n\n--- Checking all (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for all\n\n============================================================\n‚úÖ ALL VEHICLE CATEGORIES: Shares sum to 1.0 (within tolerance)\n\nTotal columns: 8\nTotal vehicle categories: 5\nTotal combinations: 40\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=34}\n```\n{'0veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '1veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '2veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n '3veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64,\n 'all': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n        PK       1.0\n HBC    Daily    1.0\n HBSch  Daily    1.0\n dtype: float64}\n```\n:::\n:::\n\n\n##### Drive to Transit\n\n::: {#4905b7c6 .cell execution_count=37}\n``` {.python .cell-code}\n# 9. Drive-to-Transit by Service Type (within drive-to-transit trips)\nprint(\"\\n\" + \"=\" * 60)\nprint(\"9. DRIVE-TO-TRANSIT BY SERVICE TYPE\")\nprint(\"=\" * 60)\n\ndrive_service_mapping = {\n    'LCL': 'dlocal',\n    'EXP': 'dexpress',\n    'LRT': 'dlrt',\n    'CRT': 'dcrt',\n    'BRT': 'dbrt'\n}\n\ndf_drive_to_transit = calculate_categorical_shares(\n    df_obs_linked,\n    category_col='Linked_Mode_txt',\n    weight_col='LINKED_WEIGHT',\n    group_cols=['Veh_Cat3p', 'Purp5_text', 'PK_OK'],\n    filter_condition='Ac_Mode2_Model == \"Drive\" & Linked_Mode_txt != \"MT\"',\n    category_mapping=drive_service_mapping,\n    prefix='calib_share'\n)\n\nprint(\"\\nShape:\", df_drive_to_transit.shape)\nprint(\"\\nFirst few rows:\")\nprint(df_drive_to_transit.head(10))\nprint(\"\\nVerification:\")\nverify_shares(df_drive_to_transit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\n9. DRIVE-TO-TRANSIT BY SERVICE TYPE\n============================================================\n\nShape: (24, 8)\n\nFirst few rows:\n                            HBO                 HBW                 NHB  \\\n                             OK        PK        OK        PK        OK   \ncalib_share_dbrt_0veh  0.000000  0.000000  0.000000  0.000000  0.085185   \ncalib_share_dbrt_1veh  0.000000  0.000000  0.000000  0.006011  0.000000   \ncalib_share_dbrt_2veh  0.000000  0.000000  0.000000  0.032543  0.235044   \ncalib_share_dbrt_3veh  0.010999  0.017082  0.021379  0.000000  0.000000   \ncalib_share_dbrt_all   0.003201  0.003659  0.007410  0.015461  0.070286   \ncalib_share_dcrt_0veh  0.325511  0.337345  0.152258  0.273792  0.273724   \ncalib_share_dcrt_1veh  0.533837  0.480993  0.388536  0.493010  0.390337   \ncalib_share_dcrt_2veh  0.517750  0.476627  0.427870  0.484774  0.764956   \ncalib_share_dcrt_3veh  0.594724  0.597261  0.493327  0.487201  0.835507   \ncalib_share_dcrt_all   0.517299  0.486644  0.423858  0.477524  0.419687   \n\n                            HBC       NHB     HBSch  \n                          Daily        PK     Daily  \ncalib_share_dbrt_0veh  0.000000  0.000000  0.000000  \ncalib_share_dbrt_1veh  0.247186  0.000000  0.305749  \ncalib_share_dbrt_2veh  0.165324  0.000000  0.040294  \ncalib_share_dbrt_3veh  0.226328  0.000000  0.000000  \ncalib_share_dbrt_all   0.207087  0.000000  0.095469  \ncalib_share_dcrt_0veh  0.788925  0.000000  0.000000  \ncalib_share_dcrt_1veh  0.425698  0.635278  0.157648  \ncalib_share_dcrt_2veh  0.409480  0.296569  0.384571  \ncalib_share_dcrt_3veh  0.328868  0.653824  0.905038  \ncalib_share_dcrt_all   0.383302  0.443292  0.434748  \n\nVerification:\n=== Verifying Share Sums ===\n\nVehicle categories found: ['0veh', '1veh', '2veh', '3veh', 'all']\n\n--- Checking 0veh (4 categories) ---\n  ‚úÖ All shares sum to 1.0 for 0veh\n\n--- Checking 1veh (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for 1veh\n\n--- Checking 2veh (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for 2veh\n\n--- Checking 3veh (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for 3veh\n\n--- Checking all (5 categories) ---\n  ‚úÖ All shares sum to 1.0 for all\n\n============================================================\n‚úÖ ALL VEHICLE CATEGORIES: Shares sum to 1.0 (within tolerance)\n\nTotal columns: 8\nTotal vehicle categories: 5\nTotal combinations: 40\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=35}\n```\n{'0veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n HBC    Daily    1.0\n NHB    PK       1.0\n HBSch  Daily    1.0\n dtype: float64,\n '1veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n HBC    Daily    1.0\n NHB    PK       1.0\n HBSch  Daily    1.0\n dtype: float64,\n '2veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n HBC    Daily    1.0\n NHB    PK       1.0\n HBSch  Daily    1.0\n dtype: float64,\n '3veh': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n HBC    Daily    1.0\n NHB    PK       1.0\n HBSch  Daily    1.0\n dtype: float64,\n 'all': HBO    OK       1.0\n        PK       1.0\n HBW    OK       1.0\n        PK       1.0\n NHB    OK       1.0\n HBC    Daily    1.0\n NHB    PK       1.0\n HBSch  Daily    1.0\n dtype: float64}\n```\n:::\n:::\n\n\n# Export Calibration Target Files\n\n::: {#f0121ef9 .cell execution_count=38}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\n\ndef create_tree_dataframe(\n    df_alltrips_cat,\n    df_nonmotorized_cat,\n    df_motorized_cat,\n    df_auto_riders,\n    df_shared_by_person,\n    df_transit_by_access,\n    df_walk_to_transit,\n    df_drive_to_transit,\n    purpose='HBW',\n    veh_cat='all',\n    period=None\n):\n    \"\"\"\n    Create a hierarchical dataframe using path format.\n    Each row represents one node with its full path from root.\n    Returns dataframe with level1, level2, level3, level4, and value columns.\n\n    Parameters:\n    -----------\n    purpose : str\n        Trip purpose (e.g., 'HBW', 'HBO', 'NHB', 'HBC', 'HBSch')\n    veh_cat : str\n        Vehicle category ('all', '0veh', '1veh', '2veh', '3veh')\n    period : str or None\n        Time period ('PK', 'OK', 'Daily', or None to average PK+OK)\n    \"\"\"\n\n    def get_value(df, var_name, purpose, veh_cat='all', period=None):\n        \"\"\"Get value for specific purpose, vehicle category, and period\"\"\"\n        var_full = f\"calib_share_{var_name}_{veh_cat}\"\n\n        if var_full not in df.index:\n            return 0.0\n\n        # If specific period is requested\n        if period:\n            if (purpose, period) in df.columns:\n                val = df.loc[var_full, (purpose, period)]\n                return val if pd.notna(val) else 0.0\n            else:\n                return 0.0\n\n        # Otherwise average PK and OK\n        total = 0.0\n        count = 0\n\n        for per in ['PK', 'OK']:\n            if (purpose, per) in df.columns:\n                val = df.loc[var_full, (purpose, per)]\n                if pd.notna(val):\n                    total += val\n                    count += 1\n\n        # If no PK/OK, try Daily\n        if count == 0 and (purpose, 'Daily') in df.columns:\n            val = df.loc[var_full, (purpose, 'Daily')]\n            if pd.notna(val):\n                return val\n\n        return total / count if count > 0 else 0.0\n\n    # Get all conditional shares\n    nonmotor_share = get_value(df_alltrips_cat, 'nonmotor', purpose, veh_cat, period)\n    motor_share = 1.0 - nonmotor_share\n\n    walk_share = get_value(df_nonmotorized_cat, 'walk', purpose, veh_cat, period)\n    bike_share = get_value(df_nonmotorized_cat, 'bike', purpose, veh_cat, period)\n\n    auto_share = get_value(df_motorized_cat, 'auto', purpose, veh_cat, period)\n    transit_share = get_value(df_motorized_cat, 'transit', purpose, veh_cat, period)\n\n    alone_share = get_value(df_auto_riders, 'alone', purpose, veh_cat, period)\n    shared_share = get_value(df_auto_riders, 'shared', purpose, veh_cat, period)\n\n    sr2_share = get_value(df_shared_by_person, 'sr2', purpose, veh_cat, period)\n    sr3_share = get_value(df_shared_by_person, 'sr3', purpose, veh_cat, period)\n\n    walkacc_share = get_value(df_transit_by_access, 'walkacc', purpose, veh_cat, period)\n    driveacc_share = get_value(df_transit_by_access, 'driveacc', purpose, veh_cat, period)\n\n    # Get walk-to-transit service type shares\n    wlocal_share = get_value(df_walk_to_transit, 'wlocal', purpose, veh_cat, period)\n    wcore_share = get_value(df_walk_to_transit, 'wcore', purpose, veh_cat, period)\n    wexpress_share = get_value(df_walk_to_transit, 'wexpress', purpose, veh_cat, period)\n    wlrt_share = get_value(df_walk_to_transit, 'wlrt', purpose, veh_cat, period)\n    wcrt_share = get_value(df_walk_to_transit, 'wcrt', purpose, veh_cat, period)\n    wbrt_share = get_value(df_walk_to_transit, 'wbrt', purpose, veh_cat, period)\n\n    # Get drive-to-transit service type shares\n    dlocal_share = get_value(df_drive_to_transit, 'dlocal', purpose, veh_cat, period)\n    dcore_share = get_value(df_drive_to_transit, 'dcore', purpose, veh_cat, period)\n    dexpress_share = get_value(df_drive_to_transit, 'dexpress', purpose, veh_cat, period)\n    dlrt_share = get_value(df_drive_to_transit, 'dlrt', purpose, veh_cat, period)\n    dcrt_share = get_value(df_drive_to_transit, 'dcrt', purpose, veh_cat, period)\n    dbrt_share = get_value(df_drive_to_transit, 'dbrt', purpose, veh_cat, period)\n\n    # Base value\n    total_value = 1.0\n\n    # Create rows in path format\n    rows = []\n\n    # Determine display period\n    display_period = period if period else 'Daily'\n\n    # Non-motorized branch\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Non-motorized',\n        'level2': 'Walk',\n        'level3': None,\n        'level4': None,\n        'value': total_value * nonmotor_share * walk_share * 100\n    })\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Non-motorized',\n        'level2': 'Bike',\n        'level3': None,\n        'level4': None,\n        'value': total_value * nonmotor_share * bike_share * 100\n    })\n\n    # Motorized > Auto > Drive Alone\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Auto',\n        'level3': 'Drive Alone',\n        'level4': None,\n        'value': total_value * motor_share * auto_share * alone_share * 100\n    })\n\n    # Motorized > Auto > Shared Ride > SR2\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Auto',\n        'level3': 'Shared Ride',\n        'level4': 'SR2 (2 people)',\n        'value': total_value * motor_share * auto_share * shared_share * sr2_share * 100\n    })\n\n    # Motorized > Auto > Shared Ride > SR3\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Auto',\n        'level3': 'Shared Ride',\n        'level4': 'SR3 (3+ people)',\n        'value': total_value * motor_share * auto_share * shared_share * sr3_share * 100\n    })\n\n    # Motorized > Transit > Walk-to-Transit > Service Types\n    walk_transit_base = total_value * motor_share * transit_share * walkacc_share * 100\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Walk-to-Transit',\n        'level4': 'Local Bus',\n        'value': walk_transit_base * wlocal_share\n    })\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Walk-to-Transit',\n        'level4': 'Core Bus',\n        'value': walk_transit_base * wcore_share\n    })\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Walk-to-Transit',\n        'level4': 'Express Bus',\n        'value': walk_transit_base * wexpress_share\n    })\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Walk-to-Transit',\n        'level4': 'LRT',\n        'value': walk_transit_base * wlrt_share\n    })\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Walk-to-Transit',\n        'level4': 'CRT',\n        'value': walk_transit_base * wcrt_share\n    })\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Walk-to-Transit',\n        'level4': 'BRT',\n        'value': walk_transit_base * wbrt_share\n    })\n\n    # Motorized > Transit > Drive-to-Transit > Service Types\n    drive_transit_base = total_value * motor_share * transit_share * driveacc_share * 100\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Drive-to-Transit',\n        'level4': 'Local Bus',\n        'value': drive_transit_base * dlocal_share\n    })\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Drive-to-Transit',\n        'level4': 'Core Bus',\n        'value': drive_transit_base * dcore_share\n    })\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Drive-to-Transit',\n        'level4': 'Express Bus',\n        'value': drive_transit_base * dexpress_share\n    })\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Drive-to-Transit',\n        'level4': 'LRT',\n        'value': drive_transit_base * dlrt_share\n    })\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Drive-to-Transit',\n        'level4': 'CRT',\n        'value': drive_transit_base * dcrt_share\n    })\n\n    rows.append({\n        'purpose': purpose,\n        'period': display_period,\n        'veh_cat': veh_cat,\n        'level1': 'Motorized',\n        'level2': 'Transit',\n        'level3': 'Drive-to-Transit',\n        'level4': 'BRT',\n        'value': drive_transit_base * dbrt_share\n    })\n\n    df_tree = pd.DataFrame(rows)\n    return df_tree\n\n\n# Create comprehensive dataframe with all combinations\n\n# Define all categories\npurposes = ['HBW', 'HBO', 'NHB', 'HBC', 'HBSch']\nperiods = ['PK', 'OK', 'Daily']\nveh_cats = ['all', '0veh', '1veh', '2veh', '3veh']\n\n# Create list to store all dataframes\nall_dfs = []\n\n# Loop through all combinations\nfor purpose in purposes:\n    for period in periods:\n        # Skip Daily for purposes that have PK/OK breakdown\n        if purpose in ['HBW', 'HBO', 'NHB'] and period == 'Daily':\n            continue\n\n        # Skip PK/OK for purposes that only have Daily\n        if purpose in ['HBC', 'HBSch'] and period in ['PK', 'OK']:\n            continue\n\n        for veh_cat in veh_cats:\n            df_temp = create_tree_dataframe(\n                df_alltrips_cat,\n                df_nonmotorized_cat,\n                df_motorized_cat,\n                df_auto_riders,\n                df_shared_by_person,\n                df_transit_by_access,\n                df_walk_to_transit,\n                df_drive_to_transit,\n                purpose=purpose,\n                veh_cat=veh_cat,\n                period=period\n            )\n            all_dfs.append(df_temp)\n\n# Combine all dataframes\ndf_tree_all = pd.concat(all_dfs, ignore_index=True)\n\ndf_tree_all.head(20)\n```\n\n::: {.cell-output .cell-output-display execution_count=36}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>purpose</th>\n      <th>period</th>\n      <th>veh_cat</th>\n      <th>level1</th>\n      <th>level2</th>\n      <th>level3</th>\n      <th>level4</th>\n      <th>value</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Non-motorized</td>\n      <td>Walk</td>\n      <td>None</td>\n      <td>None</td>\n      <td>1.534786</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Non-motorized</td>\n      <td>Bike</td>\n      <td>None</td>\n      <td>None</td>\n      <td>0.930255</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Auto</td>\n      <td>Drive Alone</td>\n      <td>None</td>\n      <td>83.567770</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Auto</td>\n      <td>Shared Ride</td>\n      <td>SR2 (2 people)</td>\n      <td>9.453987</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Auto</td>\n      <td>Shared Ride</td>\n      <td>SR3 (3+ people)</td>\n      <td>3.188857</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Walk-to-Transit</td>\n      <td>Local Bus</td>\n      <td>0.444700</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Walk-to-Transit</td>\n      <td>Core Bus</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Walk-to-Transit</td>\n      <td>Express Bus</td>\n      <td>0.013678</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Walk-to-Transit</td>\n      <td>LRT</td>\n      <td>0.396116</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Walk-to-Transit</td>\n      <td>CRT</td>\n      <td>0.088882</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Walk-to-Transit</td>\n      <td>BRT</td>\n      <td>0.068612</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Drive-to-Transit</td>\n      <td>Local Bus</td>\n      <td>0.027839</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Drive-to-Transit</td>\n      <td>Core Bus</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Drive-to-Transit</td>\n      <td>Express Bus</td>\n      <td>0.014779</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Drive-to-Transit</td>\n      <td>LRT</td>\n      <td>0.115752</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Drive-to-Transit</td>\n      <td>CRT</td>\n      <td>0.149158</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>all</td>\n      <td>Motorized</td>\n      <td>Transit</td>\n      <td>Drive-to-Transit</td>\n      <td>BRT</td>\n      <td>0.004829</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>0veh</td>\n      <td>Non-motorized</td>\n      <td>Walk</td>\n      <td>None</td>\n      <td>None</td>\n      <td>25.972483</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>0veh</td>\n      <td>Non-motorized</td>\n      <td>Bike</td>\n      <td>None</td>\n      <td>None</td>\n      <td>5.893512</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>HBW</td>\n      <td>PK</td>\n      <td>0veh</td>\n      <td>Motorized</td>\n      <td>Auto</td>\n      <td>Drive Alone</td>\n      <td>None</td>\n      <td>7.091328</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n\n\n::: {#81000c7a .cell execution_count=40}\n``` {.python .cell-code}\n# Create interactive treemap with properly coordinated dropdowns\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nimport pandas as pd\n\n# Get unique values for dropdowns\npurposes = sorted(df_tree_all['purpose'].unique())\nperiods = sorted(df_tree_all['period'].unique())\nveh_cats = sorted(df_tree_all['veh_cat'].unique())\n\n# Create all trace combinations and store them\ntraces = []\ntrace_lookup = {}  # Map (purpose, period, veh_cat) to trace index\n\nfor purpose in purposes:\n    for period in periods:\n        for veh_cat in veh_cats:\n            df_filtered = df_tree_all.query(\n                f\"purpose == '{purpose}' & veh_cat == '{veh_cat}' & period == '{period}'\"\n            ).copy()\n\n            if len(df_filtered) > 0:\n                # Create treemap trace\n                labels = []\n                parents = []\n                values = []\n\n                # Root\n                labels.append(\"All Trips\")\n                parents.append(\"\")\n                values.append(100)\n\n                # Add all hierarchy levels\n                for _, row in df_filtered.iterrows():\n                    # Level 1\n                    if row['level1'] not in labels:\n                        labels.append(row['level1'])\n                        parents.append(\"All Trips\")\n                        values.append(df_filtered[df_filtered['level1'] == row['level1']]['value'].sum())\n\n                    # Level 2\n                    if pd.notna(row['level2']):\n                        level2_id = row['level2']\n                        if level2_id not in labels:\n                            labels.append(level2_id)\n                            parents.append(row['level1'])\n                            values.append(df_filtered[\n                                (df_filtered['level1'] == row['level1']) &\n                                (df_filtered['level2'] == row['level2'])\n                            ]['value'].sum())\n\n                        # Level 3\n                        if pd.notna(row['level3']):\n                            level3_id = row['level3']\n                            if level3_id not in labels:\n                                labels.append(level3_id)\n                                parents.append(level2_id)\n                                values.append(df_filtered[\n                                    (df_filtered['level1'] == row['level1']) &\n                                    (df_filtered['level2'] == row['level2']) &\n                                    (df_filtered['level3'] == row['level3'])\n                                ]['value'].sum())\n\n                            # Level 4\n                            if pd.notna(row['level4']):\n                                level4_id = row['level4']\n                                labels.append(level4_id)\n                                parents.append(level3_id)\n                                values.append(row['value'])\n\n                trace = go.Treemap(\n                    labels=labels,\n                    parents=parents,\n                    values=values,\n                    branchvalues=\"total\",\n                    visible=False,\n                    name=f\"{purpose}_{period}_{veh_cat}\",\n                    textposition=\"middle center\"\n                )\n\n                trace_lookup[(purpose, period, veh_cat)] = len(traces)\n                traces.append(trace)\n\n# Set initial trace visible\ninitial_purpose = 'HBW'\ninitial_period = 'PK'\ninitial_veh = 'all'\n\nif (initial_purpose, initial_period, initial_veh) in trace_lookup:\n    traces[trace_lookup[(initial_purpose, initial_period, initial_veh)]].visible = True\n\n# Create figure\nfig = go.Figure(data=traces)\n\n# Create combined dropdown options (all combinations)\ndropdown_options = []\n\nfor purpose in purposes:\n    for period in periods:\n        # Check if this purpose-period combination exists\n        has_data = False\n        for veh_cat in veh_cats:\n            if (purpose, period, veh_cat) in trace_lookup:\n                has_data = True\n                break\n\n        if not has_data:\n            continue\n\n        for veh_cat in veh_cats:\n            if (purpose, period, veh_cat) in trace_lookup:\n                visible = [False] * len(traces)\n                idx = trace_lookup[(purpose, period, veh_cat)]\n                visible[idx] = True\n\n                dropdown_options.append(\n                    dict(\n                        label=f\"{purpose} | {period} | {veh_cat}\",\n                        method=\"update\",\n                        args=[\n                            {\"visible\": visible},\n                            {\"title\": f\"Mode Choice Hierarchy: {purpose} - {period} - {veh_cat}\"}\n                        ]\n                    )\n                )\n\n# Update layout with single combined dropdown\nfig.update_layout(\n    updatemenus=[\n        dict(\n            buttons=dropdown_options,\n            direction=\"down\",\n            showactive=True,\n            x=0.5,\n            xanchor=\"center\",\n            y=1.15,\n            yanchor=\"top\",\n            bgcolor=\"white\",\n            bordercolor=\"gray\",\n            borderwidth=1\n        )\n    ],\n    title=f\"Mode Choice Hierarchy: {initial_purpose} - {initial_period} - {initial_veh}\",\n    margin=dict(t=120, l=25, r=25, b=25),\n    height=800\n)\n\nfig.update_traces(root_color=\"lightgrey\")\n\nfig.show()\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>            <script src=\"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG\"></script><script type=\"text/javascript\">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: \"STIX-Web\"}});}</script>                <script type=\"text/javascript\">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>\n        <script charset=\"utf-8\" src=\"https://cdn.plot.ly/plotly-3.2.0.min.js\" integrity=\"sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=\" crossorigin=\"anonymous\"></script>                <div id=\"c804caf1-579a-44bf-8dbc-ebd2eb3e0811\" class=\"plotly-graph-div\" style=\"height:800px; width:100%;\"></div>            <script type=\"text/javascript\">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById(\"c804caf1-579a-44bf-8dbc-ebd2eb3e0811\")) {                    Plotly.newPlot(                        \"c804caf1-579a-44bf-8dbc-ebd2eb3e0811\",                        [{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBC_Daily_0veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,60.95025934965529,60.47817230173958,0.4720870479157085,39.049740650344695,12.5729739180084,4.5970394402857115,7.975934477722689,7.584233016731827,0.3917014609908615,26.476766732336298,25.554680777979186,12.000906250488084,0.0,0.11915847708154279,4.927267633463878,1.3351948994846183,7.1721535174610604,0.9220859543571122,0.0028016572047989616,0.0,0.0,0.19182735394734798,0.7274569432049652,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBC_Daily_1veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,21.74657586461322,18.11033527622384,3.63624058838938,78.25342413538678,60.23111207022086,28.702930312884696,31.528181757336164,22.31693689581504,9.211244861521124,18.022312065165927,14.12231549682793,5.628413632319338,0.0,0.06194535292332325,3.5958898918213134,0.7517139204819008,4.084352699282053,3.8999965683379987,0.5271147007575422,0.0,0.0,0.7486335854870065,1.6602226319301647,0.9640256501632856],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBC_Daily_2veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,18.35657172774888,16.492479577337146,1.8640921504117318,81.64342827225116,70.0521379284456,57.83647363112002,12.21566429732557,11.833950228576455,0.38171406874911606,11.591290343805554,7.4883773839657986,3.3848126808059718,0.0,0.1630899850096109,1.8380640359218008,0.5617296312482952,1.5406810509801196,4.102912959839756,0.6869878570764498,0.0,0.05403779711841258,1.0035141040351463,1.6800621753095184,0.6783110263002293],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBC_Daily_3veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,16.914887543311384,16.914887543311384,0.0,83.08511245668862,72.43771827591425,55.8750202948192,16.56269798109505,9.646829403080481,6.915868578014568,10.647394180774352,5.058494500555935,2.331415687195447,0.0,0.03674638353250489,0.9555549057307903,0.4757282132653016,1.2590493108318912,5.588899680218417,1.1601011846097802,0.0,0.043734802301302465,1.2821292021395088,1.8380097487811273,1.2649247423866987],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBC_Daily_all\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,22.907289385391433,21.453854969296916,1.4534344160945176,77.09271061460855,62.89211516324811,45.21816075469239,17.673954408555716,12.972103075359495,4.701851333196219,14.20059545136045,9.932838169242565,4.382003956168754,0.0,0.09073765452809965,2.2286766223030794,0.6517506512945491,2.5796692849480833,4.267757282117883,0.751325864860135,0.0,0.032767890863459485,0.9640282131434716,1.6358386673828413,0.8837966458679765],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBO_OK_0veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,46.6770122070375,42.31879342921412,4.358218777823384,53.32298779296251,38.970413818779434,9.036675050859854,29.93373876791958,21.234456061756596,8.699282706162984,14.352573974183061,13.749148824557414,6.359956569629089,0.0,0.006186561648589351,5.520454731041909,0.5269373084203139,1.3356136538175145,0.6034251496256462,0.14506587995598352,0.0,0.0,0.26193790528266236,0.19642136438700028,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBO_OK_1veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,8.506173583214755,7.3018233608205545,1.204350222394201,91.49382641678525,90.81742689260288,40.906936433447335,49.910490459155554,28.243437692513208,21.667052766642342,0.6763995241823658,0.5942392185657289,0.2557649883420911,0.0,0.000884434768412894,0.2473506009670447,0.029808589882308178,0.06043060460587209,0.08216030561663679,0.013969340604265017,0.0,0.0,0.024330744730018814,0.043860220282352945,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBO_OK_2veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,7.116750993185018,6.369737263494112,0.7470137296909066,92.88324900681502,92.67867767385317,31.82151503869469,60.85716263515849,31.171022686582,29.686139948576486,0.20457133296182742,0.16911923436760368,0.07044712333268839,0.0,0.0005260391618498099,0.0732185352724829,0.014920211926156635,0.010007324674425949,0.03545209859422371,0.0017097514279049023,0.0,0.0,0.015387013758623086,0.01835533340769573,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBO_OK_3veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,3.983880025222577,3.460426915723721,0.5234531094988563,96.01611997477742,95.85256076478586,39.23101460178933,56.62154616299654,32.555113986652174,24.066432176344367,0.16355920999155096,0.12165412157554256,0.053498802026237746,0.0,0.0,0.05133985176988327,0.005949722683136933,0.010865745096284634,0.041905088416008394,0.0035260119556159526,0.0,0.0,0.012996230245740736,0.024921946512657094,0.00046089970199461236],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBO_OK_all\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,6.687822027793943,5.902775840903125,0.7850461868908176,93.31217797220603,92.87209848536065,35.73841224068946,57.13368624467118,31.071329622391673,26.06235662227951,0.4400794868453786,0.3876484984059354,0.1715839033743379,0.0,0.00046264354901409747,0.16043573570876568,0.020356949699191745,0.03480926607462597,0.05243098843944331,0.006141018255683524,0.0,0.0,0.018999669019739564,0.027122475646621062,0.0001678255173991588],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBO_PK_0veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,29.191976107295297,26.800514061870818,2.391462045424479,70.8080238927047,60.62680809815907,8.16973575541827,52.4570723427408,15.17478971621664,37.28228262652416,10.18121579454564,9.762332964013472,4.034880927939376,0.0,0.03244806467408018,4.385081390973588,0.32788029216089065,0.9820422882655371,0.4188828305321677,0.017708954588981505,0.0,0.0,0.25986587784276155,0.14130799810042463,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBO_PK_1veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,9.356980132627273,8.35301936737273,1.003960765254544,90.64301986737274,90.10542988812269,38.07366517582747,52.031764712295214,26.984590339201258,25.047174373093956,0.5375899792500534,0.4615346479159635,0.13016379088709268,0.0,0.0,0.28013399081666446,0.021805071082589347,0.02943179512961702,0.07605533133408986,0.0051642655700536765,0.0,0.0,0.034308983229972605,0.03658208253406357,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBO_PK_2veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,7.463367609754538,6.418944069558304,1.044423540196234,92.53663239024547,92.36461337574927,28.264712285233788,64.09990109051549,29.590463371243995,34.50943771927149,0.17201901449619056,0.13722525450362238,0.06639536679936375,0.0,0.000207194862703315,0.0559042782762141,0.008145294077667741,0.006573120487673466,0.0347937599925682,0.0026187292853131153,0.0,0.0003091532650003958,0.015282218001564733,0.016583659440689957,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBO_PK_3veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,3.718936381663723,3.5951867824649755,0.12374959919874776,96.28106361833625,96.18446008201465,34.88716060506823,61.29729947694642,32.57665460341215,28.720644873534273,0.09660353632160867,0.07280733140799057,0.03141944028131075,0.0,0.001272180255249263,0.027416767996181222,0.005648188256259566,0.00705075461898977,0.023796204913618096,0.0005810569706447969,0.0,0.0,0.008596106166638062,0.014212547777632114,0.00040649399870312325],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBO_PK_all\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,6.609832423149326,5.8987802259564095,0.7110521971929171,93.39016757685064,93.0709517888103,31.95105757309891,61.1198942157114,30.143575611574818,30.976318604136576,0.31921578804033535,0.2777518260825547,0.11080100031089009,0.0,0.0009637671252151142,0.13093516963719565,0.01310899452104733,0.021942894488206507,0.04146396195778066,0.0024188488510043646,0.0,0.0001440863784406736,0.01857109242747654,0.020178207943955983,0.0001517263569031027],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBSch_Daily_0veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,84.03181957997009,82.08596033541646,1.945859244553632,15.968180420029922,5.553784374047127,0.0,5.553784374047127,0.0,5.553784374047127,10.414396045982796,10.21950313254689,8.188206108816594,0.0,0.0,1.8736984037706501,0.0,0.15759861995964686,0.19489291343590553,0.0,0.0,0.0,0.19489291343590553,0.0,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBSch_Daily_1veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,23.311647104388683,20.159591505351237,3.1520555990374475,76.68835289561135,75.43912974463481,3.155307959517267,72.28382178511754,22.280772450834853,50.00304933428269,1.2492231509765244,1.1501561183991704,0.8723106938483037,0.0,0.0,0.24636741949721308,0.0024951834223120354,0.028982821631341478,0.09906703257735405,0.011908264689295647,0.0,0.0,0.04125143199244599,0.015617718028778945,0.030289617866833474],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBSch_Daily_2veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,20.688070692662897,18.471044861150183,2.2170258315127143,79.31192930733712,79.0262702740949,2.3913127294581225,76.63495754463678,22.89277815659232,53.742179388044455,0.2856590332422155,0.2395197007986391,0.1713906978759854,0.0,0.0020808922872766577,0.04655532937669714,0.004551437652643314,0.014941343606036606,0.04613933244357637,0.010258028755538537,0.0,0.0,0.01627831963844752,0.017743864769108213,0.0018591192804820955],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBSch_Daily_3veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,15.43306437570973,13.828248885994723,1.6048154897150075,84.56693562429025,84.43425827421429,16.092791380128087,68.3414668940862,29.868274146197,38.4731927478892,0.13267735007596776,0.11461423357950865,0.08682925814952092,0.0,0.0007270169774180571,0.016381473329590997,0.00112549425907111,0.00955099086390755,0.01806311649645913,0.0017153166907236971,0.0,0.0,0.0,0.016347799805735433,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBSch_Daily_all\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,18.733412803627232,16.7116564224128,2.0217563812144306,81.2665871963728,80.92377323433132,8.794092387270801,72.12968084706053,25.97961561301415,46.15006523404637,0.34281396204145215,0.304096767549881,0.2276533725865668,0.0,0.0012491900902755267,0.05814543608340327,0.002754631330408883,0.014294137459226596,0.03871719449157114,0.0064261303425795285,0.0,0.0,0.011762528633904881,0.016832226436769186,0.0036963090783175383],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBW_OK_0veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,34.80870664432347,30.391651670536373,4.417054973787098,65.19129335567655,48.25909519732444,12.120037505420164,36.13905769190428,26.44285126694308,9.696206424961197,16.932198158352097,16.244215346541107,7.8173097109999015,0.0,0.020624440993927986,6.646091452315205,0.9563630547224086,0.8038266875096634,0.6879828118109902,0.03347258813119734,0.0,0.0,0.5497590108915025,0.10475121278829037,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBW_OK_1veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,3.8913294530363074,3.0147357027397756,0.8765937502965319,96.1086705469637,92.60055671841559,68.86047031088246,23.740086407533134,17.23549550598632,6.504590901546811,3.5081138285481086,2.985582557204838,1.3010800674233514,0.0,0.020220202611349356,1.24514134475705,0.25712444435076826,0.16201649806231858,0.5225312713432704,0.02381289111490887,0.0,0.011329754043872558,0.2843664100823314,0.20302221610215762,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBW_OK_2veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,3.5473254175273565,2.3451794349954107,1.2021459825319456,96.45267458247262,95.38391975595144,81.03291625506944,14.351003500882001,11.373109899674247,2.977893601207753,1.0687548265211952,0.7806256272958944,0.29800513620598457,0.0,0.0011415072703790852,0.37676499055488916,0.07447789110734981,0.030236102157291785,0.28812919922530095,0.011251618312472931,0.0,0.01175631291137055,0.14183936498347288,0.1232819030179846,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBW_OK_3veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,1.7481905458809137,1.5555479855160161,0.19264256036489763,98.25180945411907,97.66048057588343,84.63696365437508,13.023516921508344,10.221784621888268,2.8017322996200753,0.5913288782356471,0.34601438469387524,0.16865231821579627,0.0,0.002861161810358031,0.12160639569750809,0.031477852666577905,0.021416656303634977,0.24531449354177173,0.03858359956142365,0.0,0.00517482966050192,0.07529113684494858,0.12102026844186578,0.0052446590330318095],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBW_OK_all\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,3.6800605847790266,2.8853204375840216,0.794740147195005,96.31993941522099,94.652326047044,78.87818772864529,15.77413831839872,12.15944071511666,3.61469760328206,1.6676133681769796,1.3523338285109436,0.6022245876071892,0.0,0.005300814125351739,0.5695679502459705,0.10744730638858946,0.06779317014384267,0.3152795396660359,0.02592629467709087,0.0,0.008428937006640994,0.14495443091980806,0.13363359791360074,0.0023362791488952374],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBW_PK_0veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,31.865995325813238,25.97248339307695,5.893511932736289,68.13400467418676,34.28834846296116,7.091327969094259,27.1970204938669,23.323304344513463,3.8737161493534384,33.84565621122559,32.35066434522739,14.525559251196588,0.0,0.3502921064050501,12.421740549796501,1.8301635421291096,3.2229088957001446,1.4949918659981973,0.22173120316600964,0.0,0.0,0.863944070580377,0.40931659225181083,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBW_PK_1veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,4.720850007583493,3.3039186074659423,1.4169314001175513,95.27914999241649,91.93532991375068,70.60209846920922,21.333231444541457,16.97696498744602,4.356266457095436,3.343820078665794,2.6520849591453266,1.1133621529358046,0.0,0.0487940513040137,1.1468455688699244,0.23858003207083373,0.10450315396474986,0.691735119520467,0.07173814035062581,0.0,0.017013628087901893,0.25779333010653427,0.34103219353407604,0.004157827441328845],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBW_PK_2veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,2.331069437579499,1.438510902224977,0.8925585353545225,97.66893056242051,96.78065252247387,84.74661614198128,12.034036380492587,9.103838215612399,2.9301981648801885,0.88827803994663,0.563678006931771,0.25138916631459546,0.0,0.005021973665605917,0.22311644060503863,0.05017212247904735,0.03397830386748359,0.32460003301485907,0.02517187065310894,0.0,0.017904423670456557,0.11360262893519286,0.15735755658939737,0.010563553166703338],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBW_PK_3veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,1.2543899350604741,0.5463939853556853,0.7079959497047889,98.74561006493953,98.36143102745417,88.07790129531925,10.283529732134925,7.224567243606668,3.0589624885282567,0.3841790374853453,0.22191046441369855,0.10267499562522679,0.0,0.0034433419387632142,0.057813526433422274,0.03997584526817064,0.01800275514811565,0.16226857307164677,0.012846025436887159,0.0,0.011650034909968274,0.05871508079546443,0.07905743192932689,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"HBW_PK_all\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,2.465040546639072,1.5347856895254854,0.9302548571135865,97.53495945336091,96.21061493703263,83.56777034541447,12.64284459161816,9.453987265557053,3.1888573260611084,1.3243445163282832,1.0119870565311786,0.4446997966192744,0.0,0.013678267099052299,0.3961157126003255,0.08888153785608542,0.06861174235644099,0.3123574597971047,0.02783893066481884,0.0,0.01477943283910926,0.11575159584173408,0.1491582805544139,0.004829219897028661],\"visible\":true,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"NHB_OK_0veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,41.205997285993284,37.21936560431025,3.9866316816830385,58.79400271400672,49.868886723409894,10.710825263810397,39.1580614595995,28.985564242312112,10.172497217287388,8.925115990596826,8.422517375102528,3.226870339247065,0.0,0.0,3.720294283600715,0.14910175380842236,1.3262509984463249,0.5025986154943003,0.01395435720579866,0.0,0.0,0.3082571433911265,0.13757312498958543,0.04281398990778971],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"NHB_OK_1veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,8.350949742926705,7.510212890147759,0.8407368527789452,91.64905025707327,91.31472086400174,42.42579752200703,48.88892334199471,26.966253777525147,21.922669564469565,0.3343293930715396,0.3192466471667247,0.11264357921383161,0.0,0.0,0.13622114131267613,0.020697551476547543,0.04968437516366939,0.015082745904814916,0.0015935624890544787,0.0,0.0,0.007601826949407061,0.005887356466353375,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"NHB_OK_2veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,8.28601976831973,7.6502579046766925,0.6357618636430367,91.71398023168025,91.60365513878101,36.05684618802955,55.546808950751455,25.491344558067603,30.055464392683852,0.11032509289925464,0.10756527268818467,0.03075934761058848,0.0,0.0005331364295886089,0.04668210426054471,0.006034556956911916,0.02355612743055095,0.002759820211069978,0.0,0.0,0.0,0.0,0.002111140566484166,0.0006486796445858119],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"NHB_OK_3veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,6.54726880614248,6.174901951592647,0.37236685454983287,93.4527311938575,93.36865420505971,43.99428160425524,49.37437260080446,25.55105616467475,23.823316436129712,0.08407698879780864,0.0809259936190098,0.025603142398862223,0.0,0.0,0.03790212128032999,0.0019997805681122613,0.01542094937170534,0.0031509951787988214,0.0,0.0,0.0,0.0005183156698039195,0.002632679508994902,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"NHB_OK_all\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,8.019235797146361,7.4057071956080955,0.6135286015382658,91.98076420285365,91.74053809901713,39.90395964502819,51.83657845398894,25.827037777209057,26.009540676779885,0.24022610383652498,0.22947422905814382,0.07959962065524624,0.0,0.00023028148884337337,0.10090851053390232,0.008859433062719007,0.0398763833174329,0.010751874778381193,0.00045183926459826745,0.0,0.0,0.005031902700342994,0.004512426707085306,0.0007557061063546255],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"NHB_PK_0veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,39.79599239968907,33.07071719623211,6.725275203456958,60.20400760031095,49.444381168823895,17.85222449824361,31.59215667058028,24.82585960941239,6.766297061167889,10.759626431487046,10.503166616249187,3.9137338434631026,0.0,0.07943050009718271,4.959587145459248,0.22459630737873273,1.3258188198509213,0.2564598152378581,0.09171506071438229,0.0,0.0,0.16474475452347578,0.0,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"NHB_PK_1veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,8.858016601178576,7.8766405208548465,0.9813760803237299,91.14198339882142,90.90508021768034,46.907963600805715,43.99711661687462,22.42228278227732,21.5748338345973,0.23690318114108228,0.2175283733984687,0.07351319965094132,0.0,0.0028008493933841185,0.08805487000612656,0.03245843878476985,0.02070101556324682,0.0193748077426136,0.0,0.0,0.0,0.007066417988268691,0.012308389754344909,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"NHB_PK_2veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,6.54350558258658,6.05686456922656,0.4866410133600201,93.4564944174134,93.38518360953208,38.40273844337999,54.9824451661521,25.21944991289512,29.762995253256978,0.07131080788132739,0.0648179756554071,0.029153372699309676,0.0,0.0,0.02870154026994997,0.0033367900379503742,0.003626272648197083,0.006492832225920297,0.0026057298221002635,0.0,0.0,0.001961528609586141,0.0019255737942338925,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"NHB_PK_3veh\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,4.7383998540937595,4.373676389836717,0.3647234642570419,95.26160014590624,95.20234839516533,44.90749908010539,50.294849315059935,24.822405685484146,25.472443629575785,0.05925175074091843,0.05318654074848002,0.021775184940289686,0.0,0.0,0.0169688127508235,0.006551035512376929,0.007891507544989903,0.006065209992438413,0.0,0.0,0.0,0.0020996312976797834,0.00396557869475863,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}},{\"branchvalues\":\"total\",\"labels\":[\"All Trips\",\"Non-motorized\",\"Walk\",\"Bike\",\"Motorized\",\"Auto\",\"Drive Alone\",\"Shared Ride\",\"SR2 (2 people)\",\"SR3 (3+ people)\",\"Transit\",\"Walk-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\",\"Drive-to-Transit\",\"Local Bus\",\"Core Bus\",\"Express Bus\",\"LRT\",\"CRT\",\"BRT\"],\"name\":\"NHB_PK_all\",\"parents\":[\"\",\"All Trips\",\"Non-motorized\",\"Non-motorized\",\"All Trips\",\"Motorized\",\"Auto\",\"Auto\",\"Shared Ride\",\"Shared Ride\",\"Motorized\",\"Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Walk-to-Transit\",\"Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\",\"Drive-to-Transit\"],\"textposition\":\"middle center\",\"values\":[100,6.520296093295333,5.945997573699908,0.5742985195954253,93.47970390670466,93.31145801966106,42.269932650892585,51.041525368768475,24.549646180722394,26.491879188046084,0.16824588704359422,0.15786796715518328,0.06033003467884756,0.0,0.001045251286548671,0.0679585809171644,0.01140381419540763,0.017130286077215034,0.0103779198884109,0.0017402436548608182,0.0,0.0,0.0040372239309514205,0.004600452302598661,0.0],\"visible\":false,\"type\":\"treemap\",\"root\":{\"color\":\"lightgrey\"}}],                        {\"template\":{\"data\":{\"histogram2dcontour\":[{\"type\":\"histogram2dcontour\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"choropleth\":[{\"type\":\"choropleth\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"histogram2d\":[{\"type\":\"histogram2d\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"heatmap\":[{\"type\":\"heatmap\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"contourcarpet\":[{\"type\":\"contourcarpet\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"contour\":[{\"type\":\"contour\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"surface\":[{\"type\":\"surface\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"mesh3d\":[{\"type\":\"mesh3d\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"scatter\":[{\"fillpattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2},\"type\":\"scatter\"}],\"parcoords\":[{\"type\":\"parcoords\",\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterpolargl\":[{\"type\":\"scatterpolargl\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"bar\":[{\"error_x\":{\"color\":\"#2a3f5f\"},\"error_y\":{\"color\":\"#2a3f5f\"},\"marker\":{\"line\":{\"color\":\"#E5ECF6\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"bar\"}],\"scattergeo\":[{\"type\":\"scattergeo\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterpolar\":[{\"type\":\"scatterpolar\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"histogram\":[{\"marker\":{\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"histogram\"}],\"scattergl\":[{\"type\":\"scattergl\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatter3d\":[{\"type\":\"scatter3d\",\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattermap\":[{\"type\":\"scattermap\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattermapbox\":[{\"type\":\"scattermapbox\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterternary\":[{\"type\":\"scatterternary\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattercarpet\":[{\"type\":\"scattercarpet\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"carpet\":[{\"aaxis\":{\"endlinecolor\":\"#2a3f5f\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"minorgridcolor\":\"white\",\"startlinecolor\":\"#2a3f5f\"},\"baxis\":{\"endlinecolor\":\"#2a3f5f\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"minorgridcolor\":\"white\",\"startlinecolor\":\"#2a3f5f\"},\"type\":\"carpet\"}],\"table\":[{\"cells\":{\"fill\":{\"color\":\"#EBF0F8\"},\"line\":{\"color\":\"white\"}},\"header\":{\"fill\":{\"color\":\"#C8D4E3\"},\"line\":{\"color\":\"white\"}},\"type\":\"table\"}],\"barpolar\":[{\"marker\":{\"line\":{\"color\":\"#E5ECF6\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"barpolar\"}],\"pie\":[{\"automargin\":true,\"type\":\"pie\"}]},\"layout\":{\"autotypenumbers\":\"strict\",\"colorway\":[\"#636efa\",\"#EF553B\",\"#00cc96\",\"#ab63fa\",\"#FFA15A\",\"#19d3f3\",\"#FF6692\",\"#B6E880\",\"#FF97FF\",\"#FECB52\"],\"font\":{\"color\":\"#2a3f5f\"},\"hovermode\":\"closest\",\"hoverlabel\":{\"align\":\"left\"},\"paper_bgcolor\":\"white\",\"plot_bgcolor\":\"#E5ECF6\",\"polar\":{\"bgcolor\":\"#E5ECF6\",\"angularaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"radialaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"}},\"ternary\":{\"bgcolor\":\"#E5ECF6\",\"aaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"baxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"caxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"}},\"coloraxis\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"colorscale\":{\"sequential\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"sequentialminus\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"diverging\":[[0,\"#8e0152\"],[0.1,\"#c51b7d\"],[0.2,\"#de77ae\"],[0.3,\"#f1b6da\"],[0.4,\"#fde0ef\"],[0.5,\"#f7f7f7\"],[0.6,\"#e6f5d0\"],[0.7,\"#b8e186\"],[0.8,\"#7fbc41\"],[0.9,\"#4d9221\"],[1,\"#276419\"]]},\"xaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"white\",\"automargin\":true,\"zerolinewidth\":2},\"yaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"white\",\"automargin\":true,\"zerolinewidth\":2},\"scene\":{\"xaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2},\"yaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2},\"zaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2}},\"shapedefaults\":{\"line\":{\"color\":\"#2a3f5f\"}},\"annotationdefaults\":{\"arrowcolor\":\"#2a3f5f\",\"arrowhead\":0,\"arrowwidth\":1},\"geo\":{\"bgcolor\":\"white\",\"landcolor\":\"#E5ECF6\",\"subunitcolor\":\"white\",\"showland\":true,\"showlakes\":true,\"lakecolor\":\"white\"},\"title\":{\"x\":0.05},\"mapbox\":{\"style\":\"light\"},\"margin\":{\"b\":0,\"l\":0,\"r\":0,\"t\":30}}},\"margin\":{\"t\":120,\"l\":25,\"r\":25,\"b\":25},\"updatemenus\":[{\"bgcolor\":\"white\",\"bordercolor\":\"gray\",\"borderwidth\":1,\"buttons\":[{\"args\":[{\"visible\":[true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBC - Daily - 0veh\"}],\"label\":\"HBC | Daily | 0veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBC - Daily - 1veh\"}],\"label\":\"HBC | Daily | 1veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBC - Daily - 2veh\"}],\"label\":\"HBC | Daily | 2veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBC - Daily - 3veh\"}],\"label\":\"HBC | Daily | 3veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBC - Daily - all\"}],\"label\":\"HBC | Daily | all\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBO - OK - 0veh\"}],\"label\":\"HBO | OK | 0veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBO - OK - 1veh\"}],\"label\":\"HBO | OK | 1veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBO - OK - 2veh\"}],\"label\":\"HBO | OK | 2veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBO - OK - 3veh\"}],\"label\":\"HBO | OK | 3veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBO - OK - all\"}],\"label\":\"HBO | OK | all\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBO - PK - 0veh\"}],\"label\":\"HBO | PK | 0veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBO - PK - 1veh\"}],\"label\":\"HBO | PK | 1veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBO - PK - 2veh\"}],\"label\":\"HBO | PK | 2veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBO - PK - 3veh\"}],\"label\":\"HBO | PK | 3veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBO - PK - all\"}],\"label\":\"HBO | PK | all\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBSch - Daily - 0veh\"}],\"label\":\"HBSch | Daily | 0veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBSch - Daily - 1veh\"}],\"label\":\"HBSch | Daily | 1veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBSch - Daily - 2veh\"}],\"label\":\"HBSch | Daily | 2veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBSch - Daily - 3veh\"}],\"label\":\"HBSch | Daily | 3veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBSch - Daily - all\"}],\"label\":\"HBSch | Daily | all\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBW - OK - 0veh\"}],\"label\":\"HBW | OK | 0veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBW - OK - 1veh\"}],\"label\":\"HBW | OK | 1veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBW - OK - 2veh\"}],\"label\":\"HBW | OK | 2veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBW - OK - 3veh\"}],\"label\":\"HBW | OK | 3veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBW - OK - all\"}],\"label\":\"HBW | OK | all\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBW - PK - 0veh\"}],\"label\":\"HBW | PK | 0veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBW - PK - 1veh\"}],\"label\":\"HBW | PK | 1veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBW - PK - 2veh\"}],\"label\":\"HBW | PK | 2veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBW - PK - 3veh\"}],\"label\":\"HBW | PK | 3veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: HBW - PK - all\"}],\"label\":\"HBW | PK | all\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: NHB - OK - 0veh\"}],\"label\":\"NHB | OK | 0veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: NHB - OK - 1veh\"}],\"label\":\"NHB | OK | 1veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: NHB - OK - 2veh\"}],\"label\":\"NHB | OK | 2veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: NHB - OK - 3veh\"}],\"label\":\"NHB | OK | 3veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: NHB - OK - all\"}],\"label\":\"NHB | OK | all\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false]},{\"title\":\"Mode Choice Hierarchy: NHB - PK - 0veh\"}],\"label\":\"NHB | PK | 0veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false]},{\"title\":\"Mode Choice Hierarchy: NHB - PK - 1veh\"}],\"label\":\"NHB | PK | 1veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false]},{\"title\":\"Mode Choice Hierarchy: NHB - PK - 2veh\"}],\"label\":\"NHB | PK | 2veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false]},{\"title\":\"Mode Choice Hierarchy: NHB - PK - 3veh\"}],\"label\":\"NHB | PK | 3veh\",\"method\":\"update\"},{\"args\":[{\"visible\":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true]},{\"title\":\"Mode Choice Hierarchy: NHB - PK - all\"}],\"label\":\"NHB | PK | all\",\"method\":\"update\"}],\"direction\":\"down\",\"showactive\":true,\"x\":0.5,\"xanchor\":\"center\",\"y\":1.15,\"yanchor\":\"top\"}],\"title\":{\"text\":\"Mode Choice Hierarchy: HBW - PK - all\"},\"height\":800},                        {\"responsive\": true}                    ).then(function(){\n                            \nvar gd = document.getElementById('c804caf1-579a-44bf-8dbc-ebd2eb3e0811');\nvar x = new MutationObserver(function (mutations, observer) {{\n        var display = window.getComputedStyle(gd).display;\n        if (!display || display === 'none') {{\n            console.log([gd, 'removed!']);\n            Plotly.purge(gd);\n            observer.disconnect();\n        }}\n}});\n\n// Listen for the removal of the full notebook cells\nvar notebookContainer = gd.closest('#notebook-container');\nif (notebookContainer) {{\n    x.observe(notebookContainer, {childList: true});\n}}\n\n// Listen for the clearing of the current output cell\nvar outputEl = gd.closest('.output');\nif (outputEl) {{\n    x.observe(outputEl, {childList: true});\n}}\n\n                        })                };            </script>        </div>\n```\n:::\n:::\n\n\n## Output Folder\n\n::: {#8c2b9ae5 .cell execution_count=41}\n``` {.python .cell-code}\n# Create output directory if it doesn't exist\noutput_dir = Path(\"_output\")\noutput_dir.mkdir(parents=True, exist_ok=True)\n\nprint(\"=\" * 80)\nprint(\"EXPORTING CALIBRATION TARGET FILES\")\nprint(\"=\" * 80)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n================================================================================\nEXPORTING CALIBRATION TARGET FILES\n================================================================================\n```\n:::\n:::\n\n\n## Helper Functions\n\n### Extract Values\n\n::: {#b1f52634 .cell execution_count=42}\n``` {.python .cell-code}\ndef extract_values(df, purpose, period, pattern, include_veh_categories=True):\n    \"\"\"\n    Extract values from dataframe for given purpose/period matching a pattern.\n\n    Parameters:\n    -----------\n    df : DataFrame\n        DataFrame with MultiIndex columns (purpose, period)\n    purpose : str\n        Purpose to filter (e.g., 'HBW', 'HBO')\n    period : str\n        Period to filter (e.g., 'PK', 'OK', 'Daily')\n    pattern : str\n        Pattern to match in index (e.g., 'motor', 'bike', 'transit')\n    include_veh_categories : bool\n        If True, include all vehicle categories. If False, only include '_all' and strip suffix.\n\n    Returns:\n    --------\n    dict : {variable_name: value}\n    \"\"\"\n    results = {}\n\n    # Check if column exists\n    if (purpose, period) not in df.columns:\n        return results\n\n    # Filter rows matching pattern\n    mask = df.index.str.contains(pattern)\n\n    for idx in df[mask].index:\n        value = df.loc[idx, (purpose, period)]\n\n        if include_veh_categories:\n            # Include all vehicle categories as-is\n            results[idx] = value\n        else:\n            # Only include '_all' suffix and strip it\n            if idx.endswith('_all'):\n                # Remove '_all' suffix\n                var_name = idx.rsplit('_', 1)[0]\n                results[var_name] = value\n\n    return results\n```\n:::\n\n\n### Export Function\n\n::: {#e435daa4 .cell execution_count=43}\n``` {.python .cell-code}\ndef export_calib_file(purpose, period, include_veh_categories=True):\n    \"\"\"\n    Export calibration target file for a given purpose and period.\n\n    Parameters:\n    -----------\n    purpose : str\n        Trip purpose (HBW, HBO, NHB, HBC, HBSch)\n    period : str\n        Time period (PK, OK, Daily)\n    include_veh_categories : bool\n        If True, include vehicle category breakdowns (_0veh, _1veh, etc.)\n        If False, only use aggregate values without vehicle suffix\n    \"\"\"\n\n    # Determine file period (Daily becomes 'pk' for HBC/HBSch)\n    file_period = 'pk' if period == 'Daily' else period.lower()\n\n    # Determine display period for header\n    display_period = file_period.capitalize()\n    # display_period = 'Pk' if period == 'PK' or period == 'Daily' else 'Ok'\n\n    filename = f\"calib_target_{purpose.lower()}_{file_period}.txt\"\n    filepath = os.path.join(output_dir, filename)\n\n    print(f\"\\nCreating {filename}... (Vehicle categories: {'Yes' if include_veh_categories else 'No'})\")\n\n    with open(filepath, 'w') as f:\n        # Write header\n        f.write(f\";Calibration target values - {purpose} {display_period}\\t\\t\\n\")\n        f.write(\"\\t\\t\\n\")\n\n        # Write disclaimer\n        f.write(f\";Note: Not all of the variables listed below are used directly in the Mode Choice model. Some are included solely for verification and cross-checking purposes.\\t\\t\\n\")\n        f.write(\"\\t\\t\\n\")\n\n        # =====================================================================\n        # SECTION 1: Motorized vs Non-motorized (within total trips)\n        # =====================================================================\n        f.write(\";relative within total trips\\t\\t\\n\")\n\n        # Non-motorized shares only\n        nonmotorized = extract_values(df_alltrips_cat, purpose, period, 'nonmotor_', include_veh_categories)\n        if nonmotorized:\n            f.write(\"  ;nonmotorized shares \\t\\t\\n\")\n            for var, val in sorted(nonmotorized.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n\n        f.write(\"\\t\\t\\n\")\n        f.write(\"\\t\\t\\n\")\n\n        # =====================================================================\n        # SECTION 2: Walk vs Bike (within nonmotorized)\n        # =====================================================================\n        f.write(\";relative within nonmotorized\\t\\t\\n\")\n\n        # Walk shares\n        walk = extract_values(df_nonmotorized_cat, purpose, period, 'walk_', include_veh_categories)\n        if walk:\n            f.write(\"  ;walk shares \\t\\t\\n\")\n            for var, val in sorted(walk.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n            f.write(\"\\t\\t\\n\")\n\n        # Bike shares\n        bike = extract_values(df_nonmotorized_cat, purpose, period, 'bike_', include_veh_categories)\n        if bike:\n            f.write(\"  ;bike shares \\t\\t\\n\")\n            for var, val in sorted(bike.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n\n        f.write(\"\\t\\t\\n\")\n        f.write(\"\\t\\t\\n\")\n\n        # =====================================================================\n        # SECTION 3: Drive Alone vs Shared Ride (within auto)\n        # =====================================================================\n        f.write(\";relative within auto\\t\\t\\n\")\n\n        # Drive alone shares\n        alone = extract_values(df_auto_riders, purpose, period, 'alone_', include_veh_categories)\n        if alone:\n            f.write(\"  ;drive alone shares \\t\\t\\n\")\n            for var, val in sorted(alone.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n            f.write(\"\\t\\t\\n\")\n\n        # Shared ride shares\n        shared = extract_values(df_auto_riders, purpose, period, 'shared_', include_veh_categories)\n        if shared:\n            f.write(\"  ;shared ride shares \\t\\t\\n\")\n            for var, val in sorted(shared.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n\n        f.write(\"\\t\\t\\n\")\n        f.write(\"\\t\\t\\n\")\n\n        # =====================================================================\n        # SECTION 4: SR2 vs SR3 (within shared ride)\n        # =====================================================================\n        f.write(\";relative within shared ride\\t\\t\\n\")\n\n        # SR2 shares\n        sr2 = extract_values(df_shared_by_person, purpose, period, 'sr2_', include_veh_categories)\n        if sr2:\n            f.write(\"  ;sr2 shares \\t\\t\\n\")\n            for var, val in sorted(sr2.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n            f.write(\"\\t\\t\\n\")\n\n        # SR3 shares\n        sr3 = extract_values(df_shared_by_person, purpose, period, 'sr3_', include_veh_categories)\n        if sr3:\n            f.write(\"  ;sr3 shares \\t\\t\\n\")\n            for var, val in sorted(sr3.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n\n        f.write(\"\\t\\t\\n\")\n        f.write(\"\\t\\t\\n\")\n\n        # =====================================================================\n        # SECTION 5: Auto vs Transit (within motorized)\n        # =====================================================================\n        f.write(\";relative within motorized\\t\\t\\n\")\n\n        # Auto shares\n        auto = extract_values(df_motorized_cat, purpose, period, 'auto_', include_veh_categories)\n        if auto:\n            f.write(\"  ;auto shares \\t\\t\\n\")\n            for var, val in sorted(auto.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n            f.write(\"\\t\\t\\n\")\n\n        # Transit shares\n        transit = extract_values(df_motorized_cat, purpose, period, 'transit_', include_veh_categories)\n        if transit:\n            f.write(\"  ;transit shares \\t\\t\\n\")\n            for var, val in sorted(transit.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n            f.write(\" \\t\\t\\n\")\n\n        f.write(\"\\t\\t\\n\")\n\n        # =====================================================================\n        # SECTION 6: Transit by Service Type (within transit)\n        # =====================================================================\n        f.write(\";relative within transit\\t\\t\\n\")\n\n        # Get all transit service types\n        service_types = ['local', 'core', 'brt', 'lrt', 'express', 'crt']\n        transit_services = {}\n        for service in service_types:\n            vals = extract_values(df_transit_by_service, purpose, period, f'{service}_', include_veh_categories)\n            transit_services.update(vals)\n\n        if transit_services:\n            for var, val in sorted(transit_services.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n            f.write(\"  \\t\\t\\n\")\n\n        f.write(\"\\t\\t\\n\")\n\n        # =====================================================================\n        # SECTION 7: Walk vs Drive Access (within transit)\n        # =====================================================================\n        f.write(\";relative within transit\\t\\t\\n\")\n\n        # Walk access shares\n        walkacc = extract_values(df_transit_by_access, purpose, period, 'walkacc_', include_veh_categories)\n        if walkacc:\n            f.write(\"  ;walk-to-transit shares \\t\\t\\n\")\n            for var, val in sorted(walkacc.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n            f.write(\"\\t\\t\\n\")\n\n        # Drive access shares\n        driveacc = extract_values(df_transit_by_access, purpose, period, 'driveacc_', include_veh_categories)\n        if driveacc:\n            f.write(\"  ;drive-to-transit shares \\t\\t\\n\")\n            for var, val in sorted(driveacc.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n\n        f.write(\"\\t\\t\\n\")\n        f.write(\"\\t\\t\\n\")\n\n        # =====================================================================\n        # SECTION 8: Walk-to-Transit by Service (within walkacc)\n        # =====================================================================\n        f.write(\";relative within walkacc\\t\\t\\n\")\n\n        # Get all walk-to-transit service types\n        walk_services = {}\n        for service in ['wlocal', 'wcore', 'wbrt', 'wlrt', 'wexpress', 'wcrt']:\n            vals = extract_values(df_walk_to_transit, purpose, period, f'{service}_', include_veh_categories)\n            walk_services.update(vals)\n\n        if walk_services:\n            for var, val in sorted(walk_services.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n\n        f.write(\"\\t\\t\\n\")\n        f.write(\"\\t\\t\\n\")\n\n        # =====================================================================\n        # SECTION 9: Drive-to-Transit by Service (within driveacc)\n        # =====================================================================\n        f.write(\";relative within driveacc\\t\\t\\n\")\n\n        # Get all drive-to-transit service types\n        drive_services = {}\n        for service in ['dlocal', 'dcore', 'dbrt', 'dlrt', 'dexpress', 'dcrt']:\n            vals = extract_values(df_drive_to_transit, purpose, period, f'{service}_', include_veh_categories)\n            drive_services.update(vals)\n\n        if drive_services:\n            for var, val in sorted(drive_services.items()):\n                f.write(f\"  {var:<30}\\t=\\t{val:.4f}\\n\")\n\n    print(f\"  ‚úÖ Written to {filepath}\")\n```\n:::\n\n\n## Export All Files\n\n::: {#0cce9cad .cell execution_count=44}\n``` {.python .cell-code}\n# Define purposes and their configuration\nexport_config = {\n    'HBW':   {'periods': ['PK', 'OK'], 'include_veh': True},\n    'HBO':   {'periods': ['PK', 'OK'], 'include_veh': True},\n    'NHB':   {'periods': ['PK', 'OK'], 'include_veh': True}, # False\n    'HBC':   {'periods': ['Daily'],    'include_veh': True}, # False\n    'HBSch': {'periods': ['Daily'],    'include_veh': True}  # False\n}\n\nfor purpose, config in export_config.items():\n    for period in config['periods']:\n        export_calib_file(purpose, period, include_veh_categories=config['include_veh'])\n\nprint(\"\\n\" + \"=\" * 80)\nprint(\"‚úÖ EXPORT COMPLETE!\")\nprint(\"=\" * 80)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCreating calib_target_hbw_pk.txt... (Vehicle categories: Yes)\n  ‚úÖ Written to _output\\calib_target_hbw_pk.txt\n\nCreating calib_target_hbw_ok.txt... (Vehicle categories: Yes)\n  ‚úÖ Written to _output\\calib_target_hbw_ok.txt\n\nCreating calib_target_hbo_pk.txt... (Vehicle categories: Yes)\n  ‚úÖ Written to _output\\calib_target_hbo_pk.txt\n\nCreating calib_target_hbo_ok.txt... (Vehicle categories: Yes)\n  ‚úÖ Written to _output\\calib_target_hbo_ok.txt\n\nCreating calib_target_nhb_pk.txt... (Vehicle categories: Yes)\n  ‚úÖ Written to _output\\calib_target_nhb_pk.txt\n\nCreating calib_target_nhb_ok.txt... (Vehicle categories: Yes)\n  ‚úÖ Written to _output\\calib_target_nhb_ok.txt\n\nCreating calib_target_hbc_pk.txt... (Vehicle categories: Yes)\n  ‚úÖ Written to _output\\calib_target_hbc_pk.txt\n\nCreating calib_target_hbsch_pk.txt... (Vehicle categories: Yes)\n  ‚úÖ Written to _output\\calib_target_hbsch_pk.txt\n\n================================================================================\n‚úÖ EXPORT COMPLETE!\n================================================================================\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files\\figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n<script type=\"text/javascript\">\nwindow.PlotlyConfig = {MathJaxConfig: 'local'};\nif (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: \"STIX-Web\"}});}\n</script>\n<script type=\"module\">import \"https://cdn.plot.ly/plotly-3.2.0.min\"</script>\n\n"
      ]
    }
  }
}